
================================================================================================
FILE PATH: App.config
================================================================================================
<?xml version="1.0" encoding="utf-8"?>
<configuration>
	<configSections>
		<section name="entityFramework"
				 type="System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"
				 requirePermission="false" />
	</configSections>

	<connectionStrings>
		<add name="HotelDb"
			 providerName="MySql.Data.MySqlClient"
			 connectionString="Server=gateway01.ap-southeast-1.prod.aws.tidbcloud.com;Port=4000;Database=test;Uid=stpUZUVGbXins5N.root;Pwd=uuUFYio16Mu1aQNQ;SslMode=Required;Convert Zero Datetime=True;AllowUserVariables=True;" />
	</connectionStrings>

	<system.data>
		<DbProviderFactories>
			<remove invariant="MySql.Data.MySqlClient" />
			<add name="MySQL Data Provider"
				 invariant="MySql.Data.MySqlClient"
				 description=".NET Framework Data Provider for MySQL"
				 type="MySql.Data.MySqlClient.MySqlClientFactory, MySql.Data" />
		</DbProviderFactories>
	</system.data>

	<!-- Trỏ sang DbConfiguration của bạn -->
	<entityFramework codeConfigurationType="HotelManagement.Data.TiDbEfConfiguration, Hotel Management">
		<providers>
			<provider invariantName="MySql.Data.MySqlClient"
					  type="MySql.Data.MySqlClient.MySqlProviderServices, MySql.Data.EntityFramework" />
			<provider invariantName="System.Data.SqlClient"
					  type="System.Data.Entity.SqlServer.SqlProviderServices, EntityFramework.SqlServer" />
		</providers>
	</entityFramework>

	<runtime>
		<assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
			<!-- Fix Conflict System.Runtime.CompilerServices.Unsafe -->
			<dependentAssembly>
				<assemblyIdentity name="System.Runtime.CompilerServices.Unsafe" publicKeyToken="b03f5f7f11d50a3a" culture="neutral" />
				<bindingRedirect oldVersion="0.0.0.0-6.0.0.0" newVersion="6.0.0.0" />
			</dependentAssembly>

			<!-- Fix Conflict System.Memory -->
			<dependentAssembly>
				<assemblyIdentity name="System.Memory" publicKeyToken="cc7b13ffcd2ddd51" culture="neutral" />
				<bindingRedirect oldVersion="0.0.0.0-4.0.1.2" newVersion="4.0.1.2" />
			</dependentAssembly>

			<!-- Fix Conflict Google.Protobuf -->
			<dependentAssembly>
				<assemblyIdentity name="Google.Protobuf" publicKeyToken="a7d26565bac4d604" culture="neutral" />
				<bindingRedirect oldVersion="0.0.0.0-3.32.0.0" newVersion="3.32.0.0" />
			</dependentAssembly>

			<!-- Fix Conflict K4os.Compression.LZ4.Streams -->
			<dependentAssembly>
				<assemblyIdentity name="K4os.Compression.LZ4.Streams" publicKeyToken="2186fa9121ef231d" culture="neutral" />
				<bindingRedirect oldVersion="0.0.0.0-1.2.16.0" newVersion="1.2.16.0" />
			</dependentAssembly>

			<!-- Fix Conflict BouncyCastle -->
			<dependentAssembly>
				<assemblyIdentity name="BouncyCastle.Crypto" publicKeyToken="0e99375e54769942" culture="neutral" />
				<bindingRedirect oldVersion="0.0.0.0-1.8.5.0" newVersion="1.8.5.0" />
			</dependentAssembly>
		</assemblyBinding>
	</runtime>
</configuration>

================================================================================================
FILE PATH: Data\BookingDAL.cs
================================================================================================
using System;
using System.Collections.Generic;
using MySql.Data.MySqlClient;
using HotelManagement.Models;

namespace HotelManagement.Data
{
    public class BookingDAL                                                         
    {
        public List<Booking> GetAll()
        {
            var list = new List<Booking>();
            using (MySqlConnection conn = DbHelper.GetConnection())
            {
                string query = @"SELECT DatPhongID, KhachHangID, PhongID, NgayDen, NgayDiDuKien, NgayDiThucTe, TrangThai, TienCoc 
                                 FROM DATPHONG";
                MySqlCommand cmd = new MySqlCommand(query, conn);
                using (var rd = cmd.ExecuteReader())
                {
                    while (rd.Read())
                    {
                        list.Add(new Booking
                        {
                            DatPhongID = rd.GetInt32(0),
                            KhachHangID = rd.GetInt32(1),
                            PhongID = rd.GetInt32(2),
                            NgayDen = rd.GetDateTime(3),
                            NgayDiDuKien = rd.GetDateTime(4),
                            NgayDiThucTe = rd.IsDBNull(5) ? (DateTime?)null : rd.GetDateTime(5),
                            TrangThai = rd.GetInt32(6),
                            TienCoc = rd.GetDecimal(7)
                        });
                    }
                }
            }
            return list;
        }

        // 0 = Đặt trước, 1 = Đang ở, 2 = Đã trả
        public int CreateBooking(Booking b)
        {
            using (MySqlConnection conn = DbHelper.GetConnection())
            using (var tx = conn.BeginTransaction())
            {
                string query = @"INSERT INTO DATPHONG (KhachHangID, PhongID, NgayDen, NgayDiDuKien, NgayDiThucTe, TrangThai, TienCoc)
                                 VALUES(@KhachHangID, @PhongID, @NgayDen, @NgayDiDuKien, NULL, @TrangThai, @TienCoc);
                                 SELECT LAST_INSERT_ID();";
                MySqlCommand cmd = new MySqlCommand(query, conn, tx);
                cmd.Parameters.AddWithValue("@KhachHangID", b.KhachHangID);
                cmd.Parameters.AddWithValue("@PhongID", b.PhongID);
                cmd.Parameters.AddWithValue("@NgayDen", b.NgayDen);
                cmd.Parameters.AddWithValue("@NgayDiDuKien", b.NgayDiDuKien);
                cmd.Parameters.AddWithValue("@TrangThai", b.TrangThai);
                cmd.Parameters.AddWithValue("@TienCoc", b.TienCoc);

                var result = cmd.ExecuteScalar();
                int newId = Convert.ToInt32(result);

                // When booking created -> room status to 3
                string queryRoom = @"UPDATE PHONG SET TrangThai = 3 WHERE PhongID = @PhongID";
                MySqlCommand cmdRoom = new MySqlCommand(queryRoom, conn, tx);
                cmdRoom.Parameters.AddWithValue("@PhongID", b.PhongID);
                cmdRoom.ExecuteNonQuery();

                tx.Commit();
                return newId;
            }
        }

        public void UpdateStatus(int datPhongID, int status, DateTime? ngayDiThucTe)
        {
            using (MySqlConnection conn = DbHelper.GetConnection())
            using (var tx = conn.BeginTransaction())
            {
                string query = @"UPDATE DATPHONG
                                 SET TrangThai = @TrangThai,
                                     NgayDiThucTe = @NgayDiThucTe
                                 WHERE DatPhongID = @DatPhongID";

                MySqlCommand cmd = new MySqlCommand(query, conn, tx);
                cmd.Parameters.AddWithValue("@TrangThai", status);
                if (ngayDiThucTe.HasValue)
                    cmd.Parameters.AddWithValue("@NgayDiThucTe", ngayDiThucTe.Value);
                else
                    cmd.Parameters.AddWithValue("@NgayDiThucTe", DBNull.Value);
                cmd.Parameters.AddWithValue("@DatPhongID", datPhongID);
                cmd.ExecuteNonQuery();

                string queryRoom = "";

                if (status == 0)
                    queryRoom = @"UPDATE PHONG SET TrangThai = 3 
                                  WHERE PhongID = (SELECT PhongID FROM DATPHONG WHERE DatPhongID = @DatPhongID)";
                else if (status == 1)
                    queryRoom = @"UPDATE PHONG SET TrangThai = 1 
                                  WHERE PhongID = (SELECT PhongID FROM DATPHONG WHERE DatPhongID = @DatPhongID)";
                else if (status == 2)
                    queryRoom = @"UPDATE PHONG SET TrangThai = 2 
                                  WHERE PhongID = (SELECT PhongID FROM DATPHONG WHERE DatPhongID = @DatPhongID)";

                if (!string.IsNullOrEmpty(queryRoom))
                {
                    MySqlCommand cmdRoom = new MySqlCommand(queryRoom, conn, tx);
                    cmdRoom.Parameters.AddWithValue("@DatPhongID", datPhongID);
                    cmdRoom.ExecuteNonQuery();
                }

                tx.Commit();
            }
        }

        public Booking GetById(int id)
        {
            using (MySqlConnection conn = DbHelper.GetConnection())
            {
                string query = @"SELECT DatPhongID, KhachHangID, PhongID, NgayDen, NgayDiDuKien, NgayDiThucTe, TrangThai, TienCoc
                                 FROM DATPHONG
                                 WHERE DatPhongID = @Id";
                MySqlCommand cmd = new MySqlCommand(query, conn);
                cmd.Parameters.AddWithValue("@Id", id);

                using (var rd = cmd.ExecuteReader())
                {
                    if (rd.Read())
                    {
                        return new Booking
                        {
                            DatPhongID = rd.GetInt32(0),
                            KhachHangID = rd.GetInt32(1),
                            PhongID = rd.GetInt32(2),
                            NgayDen = rd.GetDateTime(3),
                            NgayDiDuKien = rd.GetDateTime(4),
                            NgayDiThucTe = rd.IsDBNull(5) ? (DateTime?)null : rd.GetDateTime(5),
                            TrangThai = rd.GetInt32(6),
                            TienCoc = rd.GetDecimal(7)
                        };
                    }
                }
            }
            return null;
        }

        public decimal GetDonGiaNgayByPhong(int phongID)
        {
            using (MySqlConnection conn = DbHelper.GetConnection())
            {
                string query = @"SELECT lp.DonGiaNgay
                                 FROM PHONG p
                                 JOIN LOAIPHONG lp ON p.LoaiPhongID = lp.LoaiPhongID
                                 WHERE p.PhongID = @PhongID";
                MySqlCommand cmd = new MySqlCommand(query, conn);
                cmd.Parameters.AddWithValue("@PhongID", phongID);
                object result = cmd.ExecuteScalar();
                if (result != null && result != DBNull.Value)
                    return Convert.ToDecimal(result);
            }
            return 0;
        }
    }
}


================================================================================================
FILE PATH: Data\CustomerDAL.cs
================================================================================================
using System;
using System.Collections.Generic;
using MySql.Data.MySqlClient;
using HotelManagement.Models;

namespace HotelManagement.Data
{
    public class CustomerDAL
    {
        public List<Customer> GetAll()
        {
            var list = new List<Customer>();
            using (MySqlConnection conn = DbHelper.GetConnection())
            {
                string query = "SELECT KhachHangID, HoTen, CCCD, DienThoai, DiaChi FROM KHACHHANG";
                MySqlCommand cmd = new MySqlCommand(query, conn);
                using (var rd = cmd.ExecuteReader())
                {
                    while (rd.Read())
                    {
                        list.Add(new Customer
                        {
                            KhachHangID = rd.GetInt32(0),
                            HoTen = rd.GetString(1),
                            CCCD = rd.GetString(2),
                            DienThoai = rd.IsDBNull(3) ? null : rd.GetString(3),
                            DiaChi = rd.IsDBNull(4) ? null : rd.GetString(4)
                        });
                    }
                }
            }
            return list;
        }

        public void Insert(Customer c)
        {
            using (MySqlConnection conn = DbHelper.GetConnection())
            {
                string query = @"INSERT INTO KHACHHANG (HoTen, CCCD, DienThoai, DiaChi)
                                 VALUES(@HoTen, @CCCD, @DienThoai, @DiaChi)";
                MySqlCommand cmd = new MySqlCommand(query, conn);
                cmd.Parameters.AddWithValue("@HoTen", c.HoTen);
                cmd.Parameters.AddWithValue("@CCCD", c.CCCD);
                cmd.Parameters.AddWithValue("@DienThoai", (object)c.DienThoai ?? DBNull.Value);
                cmd.Parameters.AddWithValue("@DiaChi", (object)c.DiaChi ?? DBNull.Value);
                cmd.ExecuteNonQuery();
            }
        }

        public void Update(Customer c)
        {
            using (MySqlConnection conn = DbHelper.GetConnection())
            {
                string query = @"UPDATE KHACHHANG
                                 SET HoTen = @HoTen,
                                     CCCD = @CCCD,
                                     DienThoai = @DienThoai,
                                     DiaChi = @DiaChi
                                 WHERE KhachHangID = @KhachHangID";
                MySqlCommand cmd = new MySqlCommand(query, conn);
                cmd.Parameters.AddWithValue("@HoTen", c.HoTen);
                cmd.Parameters.AddWithValue("@CCCD", c.CCCD);
                cmd.Parameters.AddWithValue("@DienThoai", (object)c.DienThoai ?? DBNull.Value);
                cmd.Parameters.AddWithValue("@DiaChi", (object)c.DiaChi ?? DBNull.Value);
                cmd.Parameters.AddWithValue("@KhachHangID", c.KhachHangID);
                cmd.ExecuteNonQuery();
            }
        }

        public void Delete(int id)
        {
            using (MySqlConnection conn = DbHelper.GetConnection())
            {
                string query = "DELETE FROM KHACHHANG WHERE KhachHangID = @Id";
                MySqlCommand cmd = new MySqlCommand(query, conn);
                cmd.Parameters.AddWithValue("@Id", id);
                cmd.ExecuteNonQuery();
            }
        }
    }
}


================================================================================================
FILE PATH: Data\DbHelper.cs
================================================================================================
using System;
using System.Configuration;
using System.Windows.Forms;
using MySql.Data.MySqlClient;

namespace HotelManagement.Data
{
    public static class DbHelper
    {
        // Reads connection string from App.config (connectionStrings name = "HotelDb")
        private static readonly string _connectionString;

        static DbHelper()
        {
            try
            {
                var cs = ConfigurationManager.ConnectionStrings["HotelDb"];
                _connectionString = cs?.ConnectionString ?? throw new InvalidOperationException("Connection string 'HotelDb' not found in App.config.");
            }
            catch (Exception ex)
            {
                MessageBox.Show(
                    "Cannot read connection string from App.config.\n\nDetails:\n" + ex.Message,
                    "Configuration error",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error);
                throw;
            }
        }

        /// <summary>
        /// Returns an opened MySqlConnection. Shows friendly message boxes on failure and rethrows.
        /// </summary>
        public static MySqlConnection GetConnection()
        {
            try
            {
                var conn = new MySqlConnection(_connectionString);
                conn.Open();
                return conn;
            }
            catch (MySqlException ex)
            {
                MessageBox.Show(
                    "Cannot connect to TiDB / MySQL.\nPlease check the connection string in App.config and network access to TiDB Cloud.\n\nDetails:\n" + ex.Message,
                    "Database connection error",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error);
                throw;
            }
            catch (Exception ex)
            {
                MessageBox.Show(
                    "Unexpected error when opening database connection.\n\nDetails:\n" + ex.Message,
                    "Database connection error",
                    MessageBoxButtons.OK,
                    MessageBoxIcon.Error);
                throw;
            }
        }
    }
}


================================================================================================
FILE PATH: Data\HotelDbContext.cs
================================================================================================
using System.Data.Entity;
using System.Data.Entity.Infrastructure; // DbConfigurationType
using HotelManagement.Models;

namespace HotelManagement.Data
{
    [DbConfigurationType(typeof(TiDbEfConfiguration))]
    public class HotelDbContext : DbContext
    {
        public HotelDbContext() : base("name=HotelDb") { }

        public DbSet<Room> Rooms { get; set; }
        public DbSet<Customer> Customers { get; set; }
        public DbSet<Booking> Bookings { get; set; }
        public DbSet<Invoice> Invoices { get; set; }
        public DbSet<User> Users { get; set; }

        protected override void OnModelCreating(DbModelBuilder modelBuilder)
        {
            modelBuilder.Entity<Room>().ToTable("PHONG");
            modelBuilder.Entity<Customer>().ToTable("KHACHHANG");
            modelBuilder.Entity<Booking>().ToTable("DATPHONG");
            modelBuilder.Entity<Invoice>().ToTable("HOADON");
            modelBuilder.Entity<User>().ToTable("USERS");

            base.OnModelCreating(modelBuilder);
        }
    }
}

================================================================================================
FILE PATH: Data\InvoiceDAL.cs
================================================================================================
using System;
using System.Collections.Generic;
using MySql.Data.MySqlClient;
using HotelManagement.Models;

namespace HotelManagement.Data
{
    public class InvoiceDAL
    {
        public void CreateInvoice(Invoice invoice)
        {
            using (MySqlConnection conn = DbHelper.GetConnection())
            {
                string query = @"INSERT INTO HOADON (DatPhongID, NgayLap, TongTien, DaThanhToan)
                                 VALUES(@DatPhongID, @NgayLap, @TongTien, @DaThanhToan)";
                MySqlCommand cmd = new MySqlCommand(query, conn);
                cmd.Parameters.AddWithValue("@DatPhongID", invoice.DatPhongID);
                cmd.Parameters.AddWithValue("@NgayLap", invoice.NgayLap);
                cmd.Parameters.AddWithValue("@TongTien", invoice.TongTien);
                cmd.Parameters.AddWithValue("@DaThanhToan", invoice.DaThanhToan ? 1 : 0);
                cmd.ExecuteNonQuery();
            }
        }

        public List<Invoice> GetInvoices(DateTime from, DateTime to)
        {
            var list = new List<Invoice>();
            using (MySqlConnection conn = DbHelper.GetConnection())
            {
                string query = @"SELECT HoaDonID, DatPhongID, NgayLap, TongTien, DaThanhToan
                                 FROM HOADON
                                 WHERE NgayLap BETWEEN @From AND @To";
                MySqlCommand cmd = new MySqlCommand(query, conn);
                cmd.Parameters.AddWithValue("@From", from);
                cmd.Parameters.AddWithValue("@To", to);

                using (var rd = cmd.ExecuteReader())
                {
                    while (rd.Read())
                    {
                        list.Add(new Invoice
                        {
                            HoaDonID = rd.GetInt32(0),
                            DatPhongID = rd.GetInt32(1),
                            NgayLap = rd.GetDateTime(2),
                            TongTien = rd.GetDecimal(3),
                            DaThanhToan = rd.GetBoolean(4)
                        });
                    }
                }
            }
            return list;
        }
    }
}

================================================================================================
FILE PATH: Data\RoomDAL.cs
================================================================================================
using System;
using System.Collections.Generic;
using MySql.Data.MySqlClient;
using HotelManagement.Models;

namespace HotelManagement.Data
{
    public class RoomDAL
    {
        // Lấy tất cả phòng
        public List<Room> GetAll()
        {
            var list = new List<Room>();

            using (MySqlConnection conn = DbHelper.GetConnection())
            {
                string query = @"SELECT PhongID, MaPhong, LoaiPhongID, Tang, TrangThai, GhiChu,
                                        ThoiGianBatDau, KieuThue, TenKhachHienThi
                                 FROM PHONG";

                using (MySqlCommand cmd = new MySqlCommand(query, conn))
                using (MySqlDataReader rd = cmd.ExecuteReader())
                {
                    while (rd.Read())
                    {
                        var room = new Room
                        {
                            PhongID = rd.GetInt32(0),
                            MaPhong = rd.GetString(1),
                            LoaiPhongID = rd.GetInt32(2),
                            Tang = rd.GetInt32(3),
                            TrangThai = rd.GetInt32(4),
                            GhiChu = rd.IsDBNull(5) ? null : rd.GetString(5),
                            ThoiGianBatDau = rd.IsDBNull(6) ? (DateTime?)null : rd.GetDateTime(6),
                            KieuThue = rd.IsDBNull(7) ? (int?)null : rd.GetInt32(7),
                            TenKhachHienThi = rd.IsDBNull(8) ? null : rd.GetString(8)
                        };

                        list.Add(room);
                    }
                }
            }

            return list;
        }

        // Lấy 1 phòng theo ID
        public Room GetById(int id)
        {
            using (MySqlConnection conn = DbHelper.GetConnection())
            {
                string query = @"SELECT PhongID, MaPhong, LoaiPhongID, Tang, TrangThai, GhiChu,
                                        ThoiGianBatDau, KieuThue, TenKhachHienThi
                                 FROM PHONG
                                 WHERE PhongID = @Id";

                using (MySqlCommand cmd = new MySqlCommand(query, conn))
                {
                    cmd.Parameters.AddWithValue("@Id", id);

                    using (MySqlDataReader rd = cmd.ExecuteReader())
                    {
                        if (rd.Read())
                        {
                            return new Room
                            {
                                PhongID = rd.GetInt32(0),
                                MaPhong = rd.GetString(1),
                                LoaiPhongID = rd.GetInt32(2),
                                Tang = rd.GetInt32(3),
                                TrangThai = rd.GetInt32(4),
                                GhiChu = rd.IsDBNull(5) ? null : rd.GetString(5),
                                ThoiGianBatDau = rd.IsDBNull(6) ? (DateTime?)null : rd.GetDateTime(6),
                                KieuThue = rd.IsDBNull(7) ? (int?)null : rd.GetInt32(7),
                                TenKhachHienThi = rd.IsDBNull(8) ? null : rd.GetString(8)
                            };
                        }
                    }
                }
            }

            return null;
        }

        public void Insert(Room room)
        {
            // (Giữ nguyên code Insert cũ nếu cần dùng chức năng thêm phòng trong tương lai)
            // Hiện tại tập trung vào UpdateTrangThaiFull
        }

        public void Update(Room room)
        {
            // (Giữ nguyên code Update admin cũ)
        }

        public void Delete(int phongId)
        {
            // (Giữ nguyên)
        }

        // Cập nhật trạng thái + ghi chú + thời gian + kiểu thuê + tên khách
        public void UpdateTrangThaiFull(int phongId,
                                        int trangThai,
                                        string ghiChu,
                                        DateTime? thoiGianBatDau,
                                        int? kieuThue,
                                        string tenKhachHienThi)
        {
            using (MySqlConnection conn = DbHelper.GetConnection())
            {
                string query = @"UPDATE PHONG SET
                                    TrangThai       = @TrangThai,
                                    GhiChu          = @GhiChu,
                                    ThoiGianBatDau  = @ThoiGianBatDau,
                                    KieuThue        = @KieuThue,
                                    TenKhachHienThi = @TenKhachHienThi
                                 WHERE PhongID = @PhongID";

                using (MySqlCommand cmd = new MySqlCommand(query, conn))
                {
                    cmd.Parameters.AddWithValue("@TrangThai", trangThai);

                    if (string.IsNullOrWhiteSpace(ghiChu))
                        cmd.Parameters.AddWithValue("@GhiChu", DBNull.Value);
                    else
                        cmd.Parameters.AddWithValue("@GhiChu", ghiChu);

                    if (thoiGianBatDau.HasValue)
                        cmd.Parameters.AddWithValue("@ThoiGianBatDau", thoiGianBatDau.Value);
                    else
                        cmd.Parameters.AddWithValue("@ThoiGianBatDau", DBNull.Value);

                    if (kieuThue.HasValue)
                        cmd.Parameters.AddWithValue("@KieuThue", kieuThue.Value);
                    else
                        cmd.Parameters.AddWithValue("@KieuThue", DBNull.Value);

                    if (string.IsNullOrWhiteSpace(tenKhachHienThi))
                        cmd.Parameters.AddWithValue("@TenKhachHienThi", DBNull.Value);
                    else
                        cmd.Parameters.AddWithValue("@TenKhachHienThi", tenKhachHienThi);

                    cmd.Parameters.AddWithValue("@PhongID", phongId);

                    cmd.ExecuteNonQuery();
                }
            }
        }
    }
}

================================================================================================
FILE PATH: Data\TiDbEfConfiguration.cs
================================================================================================
using System;
using System.Data; // Cần thiết cho ConnectionState
using System.Data.Common;
using System.Data.Entity;
using System.Data.Entity.Infrastructure.Interception;
using MySql.Data.EntityFramework;
using MySql.Data.MySqlClient;

namespace HotelManagement.Data
{
    // EF6 will pick this up via App.config codeConfigurationType or DbConfigurationType attribute
    public class TiDbEfConfiguration : MySqlEFConfiguration
    {
        public TiDbEfConfiguration()
        {
            // Register interceptor at startup
            AddInterceptor(new TiDbConnectionInterceptor());
        }
    }

    // Fix: Thực thi đầy đủ TẤT CẢ các thành viên của interface IDbConnectionInterceptor
    public class TiDbConnectionInterceptor : IDbConnectionInterceptor
    {
        // --- LOGIC CHÍNH CHO TIDB ---
        public void Opened(DbConnection connection, DbConnectionInterceptionContext interceptionContext)
        {
            if (connection is MySqlConnection mysql)
            {
                try
                {
                    using (var cmd = mysql.CreateCommand())
                    {
                        // TiDB doesn't support SERIALIZABLE; this bypasses the check per TiDB docs/error 8048.
                        cmd.CommandText = "SET SESSION tidb_skip_isolation_level_check=1;";
                        cmd.ExecuteNonQuery();
                    }
                }
                catch
                {
                    // Ignore errors to prevent crash
                }
            }
        }

        // --- CÁC PHƯƠNG THỨC BẮT BUỘC KHÁC (ĐỂ TRỐNG) ---
        public void Opening(DbConnection connection, DbConnectionInterceptionContext interceptionContext) { }

        public void BeganTransaction(DbConnection connection, BeginTransactionInterceptionContext interceptionContext) { }
        public void BeginningTransaction(DbConnection connection, BeginTransactionInterceptionContext interceptionContext) { }

        public void Closed(DbConnection connection, DbConnectionInterceptionContext interceptionContext) { }
        public void Closing(DbConnection connection, DbConnectionInterceptionContext interceptionContext) { }

        public void Disposed(DbConnection connection, DbConnectionInterceptionContext interceptionContext) { }
        public void Disposing(DbConnection connection, DbConnectionInterceptionContext interceptionContext) { }

        public void EnlistedTransaction(DbConnection connection, EnlistTransactionInterceptionContext interceptionContext) { }
        public void EnlistingTransaction(DbConnection connection, EnlistTransactionInterceptionContext interceptionContext) { }

        // Property Interception Methods
        public void ConnectionStringGetting(DbConnection connection, DbConnectionInterceptionContext<string> interceptionContext) { }
        public void ConnectionStringGot(DbConnection connection, DbConnectionInterceptionContext<string> interceptionContext) { }
        public void ConnectionStringSet(DbConnection connection, DbConnectionPropertyInterceptionContext<string> interceptionContext) { }
        public void ConnectionStringSetting(DbConnection connection, DbConnectionPropertyInterceptionContext<string> interceptionContext) { }

        public void ConnectionTimeoutGetting(DbConnection connection, DbConnectionInterceptionContext<int> interceptionContext) { }
        public void ConnectionTimeoutGot(DbConnection connection, DbConnectionInterceptionContext<int> interceptionContext) { }

        public void DatabaseGetting(DbConnection connection, DbConnectionInterceptionContext<string> interceptionContext) { }
        public void DatabaseGot(DbConnection connection, DbConnectionInterceptionContext<string> interceptionContext) { }

        public void DataSourceGetting(DbConnection connection, DbConnectionInterceptionContext<string> interceptionContext) { }
        public void DataSourceGot(DbConnection connection, DbConnectionInterceptionContext<string> interceptionContext) { }

        public void ServerVersionGetting(DbConnection connection, DbConnectionInterceptionContext<string> interceptionContext) { }
        public void ServerVersionGot(DbConnection connection, DbConnectionInterceptionContext<string> interceptionContext) { }

        public void StateGetting(DbConnection connection, DbConnectionInterceptionContext<ConnectionState> interceptionContext) { }
        public void StateGot(DbConnection connection, DbConnectionInterceptionContext<ConnectionState> interceptionContext) { }
    }
}

================================================================================================
FILE PATH: Data\UserDAL.cs
================================================================================================
using MySql.Data.MySqlClient;
using HotelManagement.Models;

namespace HotelManagement.Data
{
    public class UserDAL
    {
        public User Login(string username, string password)
        {
            using (MySqlConnection conn = DbHelper.GetConnection())
            {
                string query = @"SELECT UserID, Username, `Password`, `Role`
                                 FROM USERS
                                 WHERE Username = @Username AND `Password` = @Password";
                MySqlCommand cmd = new MySqlCommand(query, conn);
                cmd.Parameters.AddWithValue("@Username", username);
                cmd.Parameters.AddWithValue("@Password", password);

                using (var reader = cmd.ExecuteReader())
                {
                    if (reader.Read())
                    {
                        return new User
                        {
                            UserID = reader.GetInt32(0),
                            Username = reader.GetString(1),
                            Password = reader.GetString(2),
                            Role = reader.GetString(3)
                        };
                    }
                }
            }
            return null; // not found -> login failed
        }
    }
}


================================================================================================
FILE PATH: Forms\LoginForm.cs
================================================================================================
using System;
using System.Windows.Forms;
using HotelManagement.Data;
using HotelManagement.Models;

namespace HotelManagement.Forms
{
    public partial class LoginForm : Form
    {
        private readonly UserDAL userDal = new UserDAL();

        // Thuộc tính để MainForm đọc thông tin user sau khi đăng nhập
        public User LoggedInUser { get; private set; }

        public LoginForm()
        {
            InitializeComponent();
        }

        private void btnLogin_Click(object sender, EventArgs e)
        {
            string username = txtUsername.Text.Trim();
            string password = txtPassword.Text;

            if (string.IsNullOrEmpty(username) || string.IsNullOrEmpty(password))
            {
                MessageBox.Show("Vui lòng nhập đầy đủ tên đăng nhập và mật khẩu");
                return;
            }

            User user = userDal.Login(username, password);
            if (user == null)
            {
                MessageBox.Show("Đăng nhập thất bại, sai tên đăng nhập hoặc mật khẩu");
                return;
            }

            // Đăng nhập thành công: lưu lại user & trả về DialogResult.OK
            LoggedInUser = user;
            this.DialogResult = DialogResult.OK;
            this.Close();
        }

        private void btnExit_Click(object sender, EventArgs e)
        {
            // Chỉ đóng dialog, không tắt toàn bộ ứng dụng
            this.DialogResult = DialogResult.Cancel;
            this.Close();
        }
    }
}


================================================================================================
FILE PATH: Forms\LoginForm.Designer.cs
================================================================================================
using System.Windows.Forms;

namespace HotelManagement.Forms
{
    partial class LoginForm
    {
        private System.ComponentModel.IContainer components = null;
        private Label lblUsername;
        private Label lblPassword;
        private TextBox txtUsername;
        private TextBox txtPassword;
        private Button btnLogin;
        private Button btnExit;

        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
                components.Dispose();
            base.Dispose(disposing);
        }

        private void InitializeComponent()
        {
            this.lblUsername = new Label();
            this.lblPassword = new Label();
            this.txtUsername = new TextBox();
            this.txtPassword = new TextBox();
            this.btnLogin = new Button();
            this.btnExit = new Button();
            this.SuspendLayout();
            // 
            // lblUsername
            // 
            this.lblUsername.AutoSize = true;
            this.lblUsername.Location = new System.Drawing.Point(30, 30);
            this.lblUsername.Name = "lblUsername";
            this.lblUsername.Size = new System.Drawing.Size(96, 15);
            this.lblUsername.TabIndex = 0;
            this.lblUsername.Text = "Tên đăng nhập:";
            // 
            // txtUsername
            // 
            this.txtUsername.Location = new System.Drawing.Point(140, 27);
            this.txtUsername.Name = "txtUsername";
            this.txtUsername.Size = new System.Drawing.Size(180, 23);
            this.txtUsername.TabIndex = 1;
            // 
            // lblPassword
            // 
            this.lblPassword.AutoSize = true;
            this.lblPassword.Location = new System.Drawing.Point(30, 70);
            this.lblPassword.Name = "lblPassword";
            this.lblPassword.Size = new System.Drawing.Size(59, 15);
            this.lblPassword.TabIndex = 2;
            this.lblPassword.Text = "Mật khẩu:";
            // 
            // txtPassword
            // 
            this.txtPassword.Location = new System.Drawing.Point(140, 67);
            this.txtPassword.Name = "txtPassword";
            this.txtPassword.PasswordChar = '*';
            this.txtPassword.Size = new System.Drawing.Size(180, 23);
            this.txtPassword.TabIndex = 3;
            // 
            // btnLogin
            // 
            this.btnLogin.Location = new System.Drawing.Point(140, 110);
            this.btnLogin.Name = "btnLogin";
            this.btnLogin.Size = new System.Drawing.Size(80, 27);
            this.btnLogin.TabIndex = 4;
            this.btnLogin.Text = "Đăng nhập";
            this.btnLogin.UseVisualStyleBackColor = true;
            this.btnLogin.Click += new System.EventHandler(this.btnLogin_Click);
            // 
            // btnExit
            // 
            this.btnExit.Location = new System.Drawing.Point(240, 110);
            this.btnExit.Name = "btnExit";
            this.btnExit.Size = new System.Drawing.Size(80, 27);
            this.btnExit.TabIndex = 5;
            this.btnExit.Text = "Thoát";
            this.btnExit.UseVisualStyleBackColor = true;
            this.btnExit.Click += new System.EventHandler(this.btnExit_Click);
            // 
            // LoginForm
            // 
            this.AcceptButton = this.btnLogin;
            this.ClientSize = new System.Drawing.Size(364, 161);
            this.Controls.Add(this.btnExit);
            this.Controls.Add(this.btnLogin);
            this.Controls.Add(this.txtPassword);
            this.Controls.Add(this.lblPassword);
            this.Controls.Add(this.txtUsername);
            this.Controls.Add(this.lblUsername);
            this.FormBorderStyle = FormBorderStyle.FixedDialog;
            this.MaximizeBox = false;
            this.MinimizeBox = false;
            this.Name = "LoginForm";
            this.StartPosition = FormStartPosition.CenterScreen;
            this.Text = "Đăng nhập";
            this.ResumeLayout(false);
            this.PerformLayout();
        }
    }
}


================================================================================================
FILE PATH: Forms\MainForm.cs
================================================================================================
using System;
using System.Collections.Generic;
using System.Drawing;
using System.Linq;
using System.Text.RegularExpressions;
using System.Windows.Forms;
using HotelManagement.Data;
using HotelManagement.Models;

namespace HotelManagement.Forms
{
    public partial class MainForm : Form
    {
        private User _currentUser;
        private readonly RoomDAL _roomDal = new RoomDAL();

        private int? _currentFilterStatus = null;
        
        private readonly Color _placeholderColor = Color.Gray;
        private readonly Color _normalColor = Color.Black;
        private const string _placeholderText = "Nháº­p tá»« khÃ³a tÃ¬m kiáº¿m";
        
        private Timer _roomTimer;
        
        // ====== Háº°NG Sá» GIÃ ======
        private const decimal GIA_DEM_DON_SAU_18 = 200000m;
        private const decimal GIA_DEM_DON_TRUOC_18 = 250000m;
        private const decimal GIA_DEM_DON_NHIEU = 250000m;

        private const decimal GIA_DEM_DOI_SAU_18 = 300000m;
        private const decimal GIA_DEM_DOI_TRUOC_18 = 350000m;
        private const decimal GIA_DEM_DOI_NHIEU = 350000m;

        private const decimal GIA_GIO_DON_DAU = 70000m;
        private const decimal GIA_GIO_DON_SAU = 20000m;

        private const decimal GIA_GIO_DOI_DAU = 120000m;
        private const decimal GIA_GIO_DOI_SAU = 30000m;

        private const decimal GIA_NUOC_NGOT = 20000m;
        private const decimal GIA_NUOC_SUOI = 10000m;

        private const decimal PHU_THU_TRA_TRE = 40000m;

        private class RoomTileInfo
        {
            public Room Room { get; set; }
            public Label LblStartTime { get; set; } 
            public Label LblCenter { get; set; }    
            public Label LblElapsed { get; set; }   
        }

        public MainForm()
        {
            InitializeComponent();
            _currentUser = new User { Username = "KhÃ¡ch", Role = "Letan" };
        }

        public MainForm(User user) : this()
        {
            if (user != null) _currentUser = user;
        }

        private void MainForm_Load(object sender, EventArgs e)
        {
            UpdateUserUI();
            InitSearchPlaceholder();
            LoadRoomTiles();
            SetupRoomTimer();
        }

        private void MainForm_Resize(object sender, EventArgs e)
        {
            LoadRoomTiles();
        }

        private void flowRooms_ControlAdded(object sender, ControlEventArgs e)
        {
            if (e.Control is Panel panelTang)
            {
                int panelWidth = Math.Max(300, flowRooms.ClientSize.Width - 20);
                panelTang.Width = panelWidth;
            }
        }

        private void UpdateUserUI()
        {
            lblCurrentUser.Text = $"NgÆ°á»i dÃ¹ng: {_currentUser.Username} ({_currentUser.Role})";
            btnReports.Enabled = _currentUser.Role == "Admin";
        }

        #region Search placeholder

        private void InitSearchPlaceholder()
        {
            if (string.IsNullOrWhiteSpace(txtSearch.Text))
            {
                txtSearch.Text = _placeholderText;
                txtSearch.ForeColor = _placeholderColor;
            }
        }
        private void txtSearch_GotFocus(object sender, EventArgs e)
        {
            if (txtSearch.ForeColor == _placeholderColor)
            {
                txtSearch.Text = "";
                txtSearch.ForeColor = _normalColor;
            }
        }
        private void txtSearch_LostFocus(object sender, EventArgs e)
        {
            if (string.IsNullOrWhiteSpace(txtSearch.Text))
            {
                txtSearch.Text = _placeholderText;
                txtSearch.ForeColor = _placeholderColor;
            }
        }
        private void txtSearch_KeyDown(object sender, KeyEventArgs e)
        {
            if (txtSearch.ForeColor == _placeholderColor) return;
            if (e.KeyCode != Keys.Enter) return;

            string keyword = txtSearch.Text.Trim().ToLower();
            foreach (Control c in flowRooms.Controls)
            {
                if (c is Panel panelTang)
                {
                    bool anyVisible = false;
                    foreach (Control child in panelTang.Controls)
                    {
                        if (child is FlowLayoutPanel flp)
                        {
                            foreach (Control roomCard in flp.Controls)
                            {
                                if (roomCard is Panel roomPanel)
                                {
                                    string allText = string.Join(" ",
                                        roomPanel.Controls.OfType<Control>()
                                                 .SelectMany(k => Flatten(k))
                                                 .Select(k => k.Text.ToLower()));
                                    bool visible = string.IsNullOrEmpty(keyword) || allText.Contains(keyword);
                                    roomPanel.Visible = visible;
                                    if (visible) anyVisible = true;
                                }
                            }
                        }
                    }
                    panelTang.Visible = anyVisible || string.IsNullOrEmpty(keyword);
                }
            }

            IEnumerable<Control> Flatten(Control ctrl)
            {
                yield return ctrl;
                foreach (Control ch in ctrl.Controls)
                    foreach (var x in Flatten(ch)) yield return x;
            }
        }

        #endregion

        #region SÆ¡ Ä‘á»“ phÃ²ng

        private (int width, int height, int leftCol) CalcTileSize()
        {
            int w = flowRooms.ClientSize.Width;
            if (w <= 0) w = this.ClientSize.Width - panelLeft.Width - 40;

            int cols = w < 900 ? 2 : 3;
            int tileW = Math.Max(300, (w - 40 - (cols - 1) * 24) / cols);
            int tileH = Math.Max(100, (int)(tileW * 0.38));
            int leftCol = Math.Min(100, Math.Max(80, tileW / 3));
            return (tileW, tileH, leftCol);
        }

        private void LoadRoomTiles()
        {
            flowRooms.SuspendLayout();
            flowRooms.Controls.Clear();

            var rooms = _roomDal.GetAll();
            if (_currentFilterStatus.HasValue)
                rooms = rooms.FindAll(r => r.TrangThai == _currentFilterStatus.Value);
            var tangGroups = rooms.GroupBy(r => r.Tang).OrderBy(g => g.Key);

            foreach (var group in tangGroups)
            {
                var panelTang = BuildFloorPanel(group.Key, group.ToList());
                flowRooms.Controls.Add(panelTang);
            }

            flowRooms.ResumeLayout();
            if (_roomTimer != null)
                RoomTimer_Tick(this, EventArgs.Empty);
        }

        private Panel BuildFloorPanel(int tang, List<Room> roomsInFloor)
        {
            var (tileW, tileH, _) = CalcTileSize();
            int panelWidth = Math.Max(300, flowRooms.ClientSize.Width - 20);
            Panel panelTang = new Panel
            {
                Width = panelWidth,
                Margin = new Padding(10, 5, 10, 10),
                BackColor = Color.White
            };
            var header = new Panel
            {
                Height = 30,
                Dock = DockStyle.Top,
                BackColor = Color.White
            };
            var accent = new Panel
            {
                Width = 4,
                Height = 20,
                BackColor = Color.FromArgb(63, 81, 181),
                Location = new Point(0, 5)
            };
            var lbl = new Label
            {
                AutoSize = true,
                Font = new Font("Segoe UI Semibold", 10.5F, FontStyle.Bold),
                ForeColor = Color.FromArgb(55, 71, 79),
                Text = $"Táº§ng {tang}",
                Location = new Point(10, 5)
            };
            header.Controls.Add(accent);
            header.Controls.Add(lbl);
            panelTang.Controls.Add(header);

            var lblDon = new Label
            {
                AutoSize = true,
                Font = new Font("Segoe UI", 9F, FontStyle.Bold),
                ForeColor = Color.Gray,
                Text = "PhÃ²ng Ä‘Æ¡n",
                Location = new Point(10, 35)
            };
            var flowDon = new FlowLayoutPanel
            {
                Name = "flowDon",
                Location = new Point(10, 55),
                Width = panelTang.Width - 20,
                Height = tileH + 16,
                AutoScroll = false,
                WrapContents = false,
                FlowDirection = FlowDirection.LeftToRight
            };
            var lblDoi = new Label
            {
                AutoSize = true,
                Font = new Font("Segoe UI", 9F, FontStyle.Bold),
                ForeColor = Color.Gray,
                Text = "PhÃ²ng Ä‘Ã´i",
                Location = new Point(10, 55 + tileH + 50)
            };
            var flowDoi = new FlowLayoutPanel
            {
                Name = "flowDoi",
                Location = new Point(10, 75 + tileH + 50),
                Width = panelTang.Width - 20,
                Height = tileH + 16,
                AutoScroll = false,
                WrapContents = false,
                FlowDirection = FlowDirection.LeftToRight
            };
            foreach (var room in roomsInFloor.OrderBy(r => r.MaPhong))
            {
                var tile = CreateRoomTile(room);
                tile.Width = tileW;
                tile.Height = tileH;

                if (room.LoaiPhongID == 1)
                    flowDon.Controls.Add(tile);
                else
                    flowDoi.Controls.Add(tile);
            }

            panelTang.Controls.Add(lblDon);
            panelTang.Controls.Add(flowDon);
            panelTang.Controls.Add(lblDoi);
            panelTang.Controls.Add(flowDoi);
            panelTang.Height = flowDoi.Bottom + 20;
            return panelTang;
        }

        private Color GetRoomBackColor(int st)
        {
            switch (st)
            {
                case 0: return Color.FromArgb(76, 175, 80);
                case 1: return Color.FromArgb(33, 150, 243);
                case 2: return Color.FromArgb(244, 67, 54);
                case 3: return Color.FromArgb(255, 152, 0);
                default: return Color.FromArgb(158, 158, 158);
            }
        }
        private string GetStatusIcon(int st)
        {
            switch (st)
            {
                case 0: return "âœ”";
                case 1: return "ðŸ›";
                case 2: return "ðŸ§¹";
                case 3: return "ðŸ“…";
                default: return "";
            }
        }

        private static int GetIntTag(string text, string key, int defaultVal = 0)
        {
            if (string.IsNullOrEmpty(text)) return defaultVal;
            var m = Regex.Match(text, @"\b" + key + @"\s*=\s*(\d+)", RegexOptions.IgnoreCase);
            if (m.Success && int.TryParse(m.Groups[1].Value, out int v))
                return v;
            return defaultVal;
        }
        private static decimal GetDecimalTag(string text, string key, decimal defaultVal = 0m)
        {
            if (string.IsNullOrEmpty(text)) return defaultVal;
            var m = Regex.Match(text, @"\b" + key + @"\s*=\s*(\d+)", RegexOptions.IgnoreCase);
            if (m.Success && decimal.TryParse(m.Groups[1].Value, out decimal v))
                return v;
            return defaultVal;
        }
        private static string RemoveSystemTags(string text)
        {
            if (string.IsNullOrEmpty(text)) return "";
            string pattern = @"(\s*\|\s*)?(SL|NN|NS|DT)\s*=\s*[^|]*";
            string result = Regex.Replace(text, pattern, "", RegexOptions.IgnoreCase).Trim();
            if (result.EndsWith("|")) result = result.TrimEnd('|').Trim();
            return result;
        }

        private static string CombineCenter(string main, string remain, string note)
        {
            if (!string.IsNullOrWhiteSpace(remain))
                main = main + "\n" + remain;
            if (!string.IsNullOrWhiteSpace(note))
                main = main + "\n" + note;
            return main;
        }

        private decimal TinhTienDemForRoom(Room room, DateTime start, int soDem)
        {
            if (soDem <= 0) return 0m;
            bool laPhongDon = room.LoaiPhongID == 1;
            decimal tong = 0m;
            if (soDem == 1)
            {
                bool sau18h = start.TimeOfDay >= new TimeSpan(18, 0, 0);
                if (laPhongDon)
                    tong = sau18h ? GIA_DEM_DON_SAU_18 : GIA_DEM_DON_TRUOC_18;
                else
                    tong = sau18h ? GIA_DEM_DOI_SAU_18 : GIA_DEM_DOI_TRUOC_18;
            }
            else
            {
                decimal giaMoiDem = laPhongDon ? GIA_DEM_DON_NHIEU : GIA_DEM_DOI_NHIEU;
                tong = giaMoiDem * soDem;
            }

            DateTime now = DateTime.Now;
            DateTime ngayTraChuan = start.Date.AddDays(soDem).AddHours(12);
            if (now > ngayTraChuan)
                tong += PHU_THU_TRA_TRE;
            return tong;
        }

        private string CalcExtraText(Room room)
        {
            if (room.TrangThai != 1 || !room.ThoiGianBatDau.HasValue || !room.KieuThue.HasValue)
                return null;
            int kieu = room.KieuThue.Value;
            DateTime start = room.ThoiGianBatDau.Value;

            // ÄÃŠM
            if (kieu == 1)
            {
                int soDem = GetIntTag(room.GhiChu, "SL", 1);
                if (soDem <= 0) soDem = 1;

                decimal tienPhong = TinhTienDemForRoom(room, start, soDem);

                int nn = GetIntTag(room.GhiChu, "NN", 0);
                int ns = GetIntTag(room.GhiChu, "NS", 0);
                decimal tienNuoc = nn * GIA_NUOC_NGOT + ns * GIA_NUOC_SUOI;
                decimal daThu = GetDecimalTag(room.GhiChu, "DT", 0m);
                decimal conLai = Math.Max(0, tienPhong + tienNuoc - daThu);

                DateTime end = start.Date.AddDays(soDem);
                TimeSpan left = end - DateTime.Now;
                int nightsLeft = (int)Math.Ceiling(left.TotalDays);
                string line1 = nightsLeft <= 0 ? "QuÃ¡ háº¡n" : "CÃ²n " + nightsLeft + " Ä‘Ãªm";
                string line2 = "ChÆ°a thu: " + conLai.ToString("N0") + " Ä‘";

                return line1 + "\n" + line2;
            }

            // GIá»œ
            if (kieu == 3)
            {
                DateTime now = DateTime.Now;
                if (now < start) now = start;

                TimeSpan diff = now - start;
                int soGio = Math.Max(1, (int)Math.Ceiling(diff.TotalHours));
                bool laPhongDon = room.LoaiPhongID == 1;
                decimal giaGioDau = laPhongDon ? GIA_GIO_DON_DAU : GIA_GIO_DOI_DAU;
                decimal giaGioSau = laPhongDon ? GIA_GIO_DON_SAU : GIA_GIO_DOI_SAU;

                decimal tienPhong = (soGio <= 1)
                    ? giaGioDau
                    : giaGioDau + (soGio - 1) * giaGioSau;
                int nn = GetIntTag(room.GhiChu, "NN", 0);
                int ns = GetIntTag(room.GhiChu, "NS", 0);
                decimal tienNuoc = nn * GIA_NUOC_NGOT + ns * GIA_NUOC_SUOI;

                decimal daThu = GetDecimalTag(room.GhiChu, "DT", 0m);
                decimal conLai = Math.Max(0, tienPhong + tienNuoc - daThu);

                return "Pháº£i thu: " + conLai.ToString("N0") + " Ä‘";
            }

            return null;
        }

        private Panel CreateRoomTile(Room room)
        {
            var (tileW, tileH, leftCol) = CalcTileSize();
            Color baseColor = GetRoomBackColor(room.TrangThai);
            Color lightColor = ControlPaint.Light(baseColor, 0.80f);
            Color textColor = ControlPaint.Dark(baseColor, 0.20f);
            var panel = new Panel
            {
                Width = tileW,
                Height = tileH,
                Margin = new Padding(12, 8, 12, 8),
                BackColor = Color.White
            };
            panel.Paint += (s, e) =>
            {
                using (var pen = new Pen(Color.FromArgb(210, 210, 210)))
                    e.Graphics.DrawRectangle(pen, 0, 0, panel.Width - 1, panel.Height - 1);
            };

            var leftPanel = new Panel { Width = leftCol, Dock = DockStyle.Left, BackColor = baseColor, Padding = new Padding(0, 6, 0, 6) };
            var lblStd = new Label
            {
                Dock = DockStyle.Top,
                Height = 18,
                TextAlign = ContentAlignment.MiddleCenter,
                Font = new Font("Segoe UI", 7.5f, FontStyle.Bold),
                ForeColor = Color.White,
                Text = "STD"
            };
            var lblIcon = new Label
            {
                Dock = DockStyle.Bottom,
                Height = 22,
                TextAlign = ContentAlignment.MiddleCenter,
                Font = new Font("Segoe UI", 11F, FontStyle.Bold),
                ForeColor = Color.White,
                Text = GetStatusIcon(room.TrangThai)
            };
            var lblCode = new Label
            {
                Dock = DockStyle.Fill,
                TextAlign = ContentAlignment.MiddleCenter,
                Font = new Font("Segoe UI Semibold", 16F, FontStyle.Bold),
                ForeColor = Color.White,
                Text = room.MaPhong
            };
            leftPanel.Controls.Add(lblCode);
            leftPanel.Controls.Add(lblIcon);
            leftPanel.Controls.Add(lblStd);

            var rightPanel = new Panel { Dock = DockStyle.Fill, BackColor = lightColor, Padding = new Padding(6) };
            var lblStartTime = new Label
            {
                Height = 18,
                Dock = DockStyle.Top,
                TextAlign = ContentAlignment.MiddleCenter,
                Font = new Font("Segoe UI", 8F),
                ForeColor = Color.FromArgb(120, 0, 0, 0),
                Name = "lblStartTime"
            };
            var lblCenter = new Label
            {
                Dock = DockStyle.Fill,
                TextAlign = ContentAlignment.MiddleCenter,
                AutoSize = false,
                Font = new Font("Segoe UI", 12.5f, FontStyle.Bold),
                ForeColor = textColor,
                Name = "lblCenter"
            };
            var lblElapsed = new Label
            {
                Height = 20,
                Dock = DockStyle.Bottom,
                TextAlign = ContentAlignment.BottomCenter,
                Font = new Font("Segoe UI", 9F, FontStyle.Bold),
                ForeColor = Color.FromArgb(120, 0, 0, 0),
                Name = "lblElapsed"
            };
            rightPanel.Controls.Add(lblCenter);
            rightPanel.Controls.Add(lblElapsed);
            rightPanel.Controls.Add(lblStartTime);

            panel.Controls.Add(rightPanel);
            panel.Controls.Add(leftPanel);

            if (!string.IsNullOrWhiteSpace(room.GhiChu))
            {
                var tip = new ToolTip();
                tip.SetToolTip(panel, RemoveSystemTags(room.GhiChu));
            }

            panel.MouseEnter += (s, e) => panel.BackColor = Color.FromArgb(250, 250, 250);
            panel.MouseLeave += (s, e) => panel.BackColor = Color.White;

            void AttachClick(Control c)
            {
                c.Cursor = Cursors.Hand;
                if (room.TrangThai == 2) 
                {
                    c.Click += (s, e) => { };
                    c.DoubleClick += (s, e) => SetRoomFromDirtyToEmpty(room);
                }
                else
                {
                    c.Click += (s, e) => ShowRoomDetail(room);
                }

                foreach (Control k in c.Controls) AttachClick(k);
            }
            AttachClick(panel);
            string center;
            switch (room.TrangThai)
            {
                case 0: center = "Trá»‘ng"; break;
                case 2: center = "ChÆ°a dá»n"; break;
                case 3: center = "ÄÃ£ cÃ³ khÃ¡ch Ä‘áº·t"; break;
                case 1: center = room.TenKhachHienThi ?? ""; break;
                default: center = ""; break;
            }

            string extra = CalcExtraText(room);
            string note = (room.TrangThai == 1 && !string.IsNullOrWhiteSpace(room.GhiChu) &&
                           !string.IsNullOrWhiteSpace(RemoveSystemTags(room.GhiChu)))
                          ? "(CÃ³ ghi chÃº)" : null;
            lblCenter.Text = CombineCenter(center, extra, note);

            var info = new RoomTileInfo
            {
                Room = room,
                LblStartTime = lblStartTime,
                LblCenter = lblCenter,
                LblElapsed = lblElapsed
            };
            panel.Tag = info;

            return panel;
        }

        private void SetRoomFromDirtyToEmpty(Room room)
        {
            room.TrangThai = 0;
            room.ThoiGianBatDau = null;
            room.KieuThue = null;
            room.TenKhachHienThi = null;

            string ghiChu = RemoveSystemTags(room.GhiChu);
            _roomDal.UpdateTrangThaiFull(room.PhongID, room.TrangThai, ghiChu, null, null, null);
            room.GhiChu = ghiChu;

            LoadRoomTiles();
        }

        #endregion

        #region Timer cáº­p nháº­t thá»i gian

        private void SetupRoomTimer()
        {
            if (_roomTimer != null) return;
            _roomTimer = new Timer { Interval = 1000 };
            _roomTimer.Tick += RoomTimer_Tick;
            _roomTimer.Start();
        }

        private void RoomTimer_Tick(object sender, EventArgs e)
        {
            foreach (Control floor in flowRooms.Controls)
            {
                if (floor is Panel panelTang)
                {
                    foreach (Control child in panelTang.Controls.OfType<FlowLayoutPanel>())
                    {
                        foreach (Control roomPanel in child.Controls)
                        {
                            Panel p = roomPanel as Panel;
                            if (p != null)
                            {
                                RoomTileInfo info = p.Tag as RoomTileInfo;
                                if (info != null)
                                {
                                    UpdateRoomTileTime(info);
                                }
                                else
                                {
                                    Room r = p.Tag as Room;
                                    if (r != null)
                                    {
                                        var info2 = new RoomTileInfo
                                        {
                                            Room = r,
                                            LblStartTime = FindByName<Label>(p, "lblStartTime"),
                                            LblCenter = FindByName<Label>(p, "lblCenter"),
                                            LblElapsed = FindByName<Label>(p, "lblElapsed"),
                                        };
                                        p.Tag = info2;
                                        UpdateRoomTileTime(info2);
                                    }
                                }
                            }
                        }
                    }
                }
            }

            T FindByName<T>(Control root, string name) where T : Control
            {
                foreach (Control c in Flatten(root))
                {
                    T t = c as T;
                    if (t != null && t.Name == name) return t;
                }
                return null;
            }

            IEnumerable<Control> Flatten(Control c)
            {
                yield return c;
                foreach (Control k in c.Controls)
                    foreach (Control x in Flatten(k))
                        yield return x;
            }
        }

        private void UpdateRoomTileTime(RoomTileInfo info)
        {
            Room r = info.Room;
            if (r.TrangThai == 1 && r.ThoiGianBatDau.HasValue)
            {
                DateTime start = r.ThoiGianBatDau.Value;
                DateTime now = DateTime.Now;

                info.LblStartTime.Text = start.ToString("dd/MM/yyyy, HH:mm");

                string main = (r.KieuThue == 3) ? "" : (r.TenKhachHienThi ?? "");
                string extra = CalcExtraText(r);
                string note = (!string.IsNullOrWhiteSpace(r.GhiChu) &&
                               !string.IsNullOrWhiteSpace(RemoveSystemTags(r.GhiChu)))
                              ? "(CÃ³ ghi chÃº)" : null;
                if (string.IsNullOrWhiteSpace(main))
                    main = "CÃ³ khÃ¡ch";
                info.LblCenter.Text = CombineCenter(main, extra, note);

                TimeSpan diff = now - start;
                if (diff.TotalSeconds < 0) diff = TimeSpan.Zero;
                info.LblElapsed.Text = string.Format("{0:00} : {1:00} : {2:00}",
                    (int)diff.TotalHours, diff.Minutes, diff.Seconds);
            }
            else
            {
                info.LblStartTime.Text = "";
                info.LblElapsed.Text = "";

                string text;
                switch (r.TrangThai)
                {
                    case 0: text = "Trá»‘ng"; break;
                    case 2: text = "ChÆ°a dá»n"; break;
                    case 3: text = "ÄÃ£ cÃ³ khÃ¡ch Ä‘áº·t"; break;
                    default: text = ""; break;
                }
                info.LblCenter.Text = text;
            }
        }

        #endregion

        #region Äiá»u hÆ°á»›ng/forms

        private void ShowRoomDetail(Room room)
        {
            if (room.TrangThai == 0)
            {
                room.TrangThai = 1;
                room.KieuThue = 3;
                room.ThoiGianBatDau = DateTime.Now;
                room.TenKhachHienThi = null;
            }

            // áº¨n cÃ¡c panel danh sÃ¡ch phÃ²ng
            flowRooms.Visible = false;
            panelFilter.Visible = false;
            
            // --- Cáº¬P NHáº¬T QUAN TRá»ŒNG: Fill toÃ n bá»™ form ---
            panelDetailHost.Dock = DockStyle.Fill;
            panelDetailHost.Controls.Clear();

            var detail = new RoomDetailForm(room)
            {
                TopLevel = false,
                FormBorderStyle = FormBorderStyle.None,
                Dock = DockStyle.Fill
            };
            detail.BackRequested += (s, e) =>
            {
                panelDetailHost.Visible = false;
                panelDetailHost.Controls.Clear();
                
                // Tráº£ vá» máº·c Ä‘á»‹nh (dÃ¹ khÃ´ng hiá»‡n)
                panelDetailHost.Dock = DockStyle.Right;
                panelDetailHost.Width = 420;

                // Hiá»‡n láº¡i danh sÃ¡ch phÃ²ng
                panelFilter.Visible = true;
                flowRooms.Visible = true;
                LoadRoomTiles();
            };

            detail.Saved += (s, e) =>
            {
                var updated = _roomDal.GetById(room.PhongID);
                if (updated != null)
                    room = updated;
                LoadRoomTiles();
            };

            panelDetailHost.Visible = true;
            panelDetailHost.Controls.Add(detail);
            panelDetailHost.BringToFront();
            detail.Show();
        }

        private void btnRooms_Click(object sender, EventArgs e)
        {
            // NÃºt "SÆ¡ Ä‘á»“ phÃ²ng" cÅ©ng Ä‘Ã³ng detail form
            panelDetailHost.Visible = false;
            panelDetailHost.Controls.Clear();
            panelDetailHost.Dock = DockStyle.Right;

            panelFilter.Visible = true;
            flowRooms.Visible = true;
            LoadRoomTiles();
        }
        private void btnReports_Click(object sender, EventArgs e)
        {
            MessageBox.Show("Chá»©c nÄƒng bÃ¡o cÃ¡o sáº½ Ä‘Æ°á»£c bá»• sung sau.", "ThÃ´ng bÃ¡o");
        }
        private void btnAdmin_Click(object sender, EventArgs e)
        {
            using (var login = new LoginForm())
            {
                if (login.ShowDialog(this) == DialogResult.OK && login.LoggedInUser != null)
                {
                    _currentUser = login.LoggedInUser;
                    UpdateUserUI();
                    MessageBox.Show("Xin chÃ o: " + _currentUser.Username, "ÄÄƒng nháº­p thÃ nh cÃ´ng");
                }
            }
        }
        private void btnExit_Click(object sender, EventArgs e)
        {
            this.Close();
        }

        private void btnFilterAll_Click(object sender, EventArgs e) { _currentFilterStatus = null; LoadRoomTiles(); }
        private void btnFilterTrong_Click(object sender, EventArgs e) { _currentFilterStatus = 0; LoadRoomTiles(); }
        private void btnFilterCoKhach_Click(object sender, EventArgs e) { _currentFilterStatus = 1; LoadRoomTiles(); }
        private void btnFilterChuaDon_Click(object sender, EventArgs e) { _currentFilterStatus = 2; LoadRoomTiles(); }
        private void btnFilterDaDat_Click(object sender, EventArgs e) { _currentFilterStatus = 3; LoadRoomTiles(); }

        #endregion
    }
}


================================================================================================
FILE PATH: Forms\MainForm.Designer.cs
================================================================================================
using System.Windows.Forms;
using System.Drawing;

namespace HotelManagement.Forms
{
    partial class MainForm
    {
        private System.ComponentModel.IContainer components = null;

        private Panel panelTop;
        private Panel panelLeft;
        private Panel panelFilter;
        private FlowLayoutPanel flowRooms;
        private Panel panelDetailHost;

        private Button btnAdmin;
        private Button btnExit;
        private Label lblTitle;
        private TextBox txtSearch;

        private Button btnSoDoPhong;
        private Button btnThongKe;
        private Button btnReports;
        private Label lblCurrentUser;

        private Button btnFilterAll;
        private Button btnFilterTrong;
        private Button btnFilterCoKhach;
        private Button btnFilterChuaDon;
        private Button btnFilterDaDat;

        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null)) components.Dispose();
            base.Dispose(disposing);
        }

        private void InitializeComponent()
        {
            components = new System.ComponentModel.Container();

            // ===== FORM CHÃNH =====
            this.AutoScaleMode = AutoScaleMode.Font;
            this.ClientSize = new Size(1200, 750);
            this.Text = "Quáº£n lÃ½ khÃ¡ch sáº¡n";
            this.StartPosition = FormStartPosition.CenterScreen;
            this.BackColor = Color.FromArgb(245, 245, 245);
            this.MinimumSize = new Size(1000, 600);
            this.Load += new System.EventHandler(this.MainForm_Load);
            // gá»i láº¡i má»—i khi resize Ä‘á»ƒ co giÃ£n khung táº§ng
            this.Resize += new System.EventHandler(this.MainForm_Resize);

            // ===== THANH TRÃŠN (TOP BAR) =====
            panelTop = new Panel
            {
                BackColor = Color.FromArgb(63, 81, 181),
                Dock = DockStyle.Top,
                Height = 60,
                Padding = new Padding(10, 10, 10, 10)
            };

            var topLayout = new TableLayoutPanel
            {
                Dock = DockStyle.Fill,
                ColumnCount = 3,
                RowCount = 1
            };
            topLayout.ColumnStyles.Add(new ColumnStyle(SizeType.AutoSize));
            topLayout.ColumnStyles.Add(new ColumnStyle(SizeType.Percent, 100f));
            topLayout.ColumnStyles.Add(new ColumnStyle(SizeType.AutoSize));

            var panelTopLeft = new FlowLayoutPanel
            {
                FlowDirection = FlowDirection.LeftToRight,
                WrapContents = false,
                Dock = DockStyle.Fill,
                Margin = new Padding(0),
                Padding = new Padding(0),
                AutoSize = true,
                AutoSizeMode = AutoSizeMode.GrowAndShrink
            };

            btnAdmin = new Button
            {
                FlatStyle = FlatStyle.Flat,
                ForeColor = Color.White,
                Font = new Font("Segoe UI", 9F, FontStyle.Bold),
                Text = "â‰¡",
                Width = 40,
                Height = 40,
                Margin = new Padding(0, 0, 10, 0),
                TabStop = false
            };
            btnAdmin.FlatAppearance.BorderSize = 0;
            btnAdmin.Click += new System.EventHandler(this.btnAdmin_Click);

            lblTitle = new Label
            {
                AutoSize = true,
                ForeColor = Color.White,
                Font = new Font("Segoe UI Semibold", 12F, FontStyle.Bold),
                Text = "Thanh Long Hotel",
                Margin = new Padding(0, 8, 0, 0)
            };

            panelTopLeft.Controls.Add(btnAdmin);
            panelTopLeft.Controls.Add(lblTitle);

            txtSearch = new TextBox
            {
                Font = new Font("Segoe UI", 10F),
                Margin = new Padding(10, 8, 10, 8),
                Text = ""
            };
            txtSearch.Dock = DockStyle.Fill;
            txtSearch.KeyDown += new KeyEventHandler(this.txtSearch_KeyDown);
            txtSearch.GotFocus += new System.EventHandler(this.txtSearch_GotFocus);
            txtSearch.LostFocus += new System.EventHandler(this.txtSearch_LostFocus);

            btnExit = new Button
            {
                FlatStyle = FlatStyle.Flat,
                ForeColor = Color.White,
                Font = new Font("Segoe UI", 9F, FontStyle.Bold),
                Text = "ThoÃ¡t",
                Width = 75,
                Height = 35,
                Margin = new Padding(0, 8, 0, 8)
            };
            btnExit.FlatAppearance.BorderSize = 0;
            btnExit.Click += new System.EventHandler(this.btnExit_Click);

            topLayout.Controls.Add(panelTopLeft, 0, 0);
            topLayout.Controls.Add(txtSearch, 1, 0);
            topLayout.Controls.Add(btnExit, 2, 0);

            panelTop.Controls.Add(topLayout);

            // ===== MENU TRÃI =====
            panelLeft = new Panel
            {
                BackColor = Color.FromArgb(248, 249, 252),
                Dock = DockStyle.Left,
                Width = 220,
                Padding = new Padding(0, 10, 0, 10)
            };

            btnSoDoPhong = MakeLeftButton("SÆ¡ Ä‘á»“ phÃ²ng", 10);
            btnSoDoPhong.Click += new System.EventHandler(this.btnRooms_Click);

            btnThongKe = MakeLeftButton("Thá»‘ng kÃª", 50);
            btnReports = MakeLeftButton("BÃ¡o cÃ¡o", 90);

            lblCurrentUser = new Label
            {
                Dock = DockStyle.Bottom,
                Height = 30,
                Font = new Font("Segoe UI", 9F),
                ForeColor = Color.Gray,
                TextAlign = ContentAlignment.MiddleLeft,
                Padding = new Padding(12, 0, 0, 0),
                Text = "NgÆ°á»i dÃ¹ng: (khÃ¡ch)"
            };

            panelLeft.Controls.Add(btnSoDoPhong);
            panelLeft.Controls.Add(btnThongKe);
            panelLeft.Controls.Add(btnReports);
            panelLeft.Controls.Add(lblCurrentUser);

            // ===== PANEL MAIN =====
            var panelMain = new Panel
            {
                Dock = DockStyle.Fill,
                BackColor = Color.FromArgb(245, 245, 245)
            };

            // ----- THANH FILTER -----
            panelFilter = new Panel
            {
                BackColor = Color.White,
                Dock = DockStyle.Top,
                Height = 60,
                Padding = new Padding(10)
            };

            var panelFilterInner = new FlowLayoutPanel
            {
                Dock = DockStyle.Fill,
                FlowDirection = FlowDirection.LeftToRight,
                WrapContents = false,
                AutoScroll = true
            };

            btnFilterAll = MakeFilter("Táº¥t cáº£", Color.FromArgb(158, 158, 158));
            btnFilterAll.Click += new System.EventHandler(this.btnFilterAll_Click);

            btnFilterTrong = MakeFilter("Trá»‘ng", Color.FromArgb(76, 175, 80));
            btnFilterTrong.Click += new System.EventHandler(this.btnFilterTrong_Click);

            btnFilterCoKhach = MakeFilter("CÃ³ khÃ¡ch", Color.FromArgb(33, 150, 243));
            btnFilterCoKhach.Click += new System.EventHandler(this.btnFilterCoKhach_Click);

            btnFilterChuaDon = MakeFilter("ChÆ°a dá»n", Color.FromArgb(96, 125, 139));
            btnFilterChuaDon.Click += new System.EventHandler(this.btnFilterChuaDon_Click);

            btnFilterDaDat = MakeFilter("ÄÃ£ cÃ³ khÃ¡ch Ä‘áº·t", Color.FromArgb(255, 152, 0));
            btnFilterDaDat.Click += new System.EventHandler(this.btnFilterDaDat_Click);

            panelFilterInner.Controls.Add(btnFilterAll);
            panelFilterInner.Controls.Add(btnFilterTrong);
            panelFilterInner.Controls.Add(btnFilterCoKhach);
            panelFilterInner.Controls.Add(btnFilterChuaDon);
            panelFilterInner.Controls.Add(btnFilterDaDat);

            panelFilter.Controls.Add(panelFilterInner);

            // ----- CENTER: DANH SÃCH PHÃ’NG + CHI TIáº¾T -----
            var panelCenter = new Panel
            {
                Dock = DockStyle.Fill,
                BackColor = Color.FromArgb(245, 245, 245)
            };

            // FlowLayoutPanel chá»©a cÃ¡c "khung táº§ng"
            flowRooms = new FlowLayoutPanel
            {
                Dock = DockStyle.Fill,
                AutoScroll = true,
                Padding = new Padding(10),
                BackColor = Color.FromArgb(245, 245, 245),

                // má»—i táº§ng 1 dÃ²ng, full width, xáº¿p tá»« trÃªn xuá»‘ng dÆ°á»›i
                WrapContents = false,
                FlowDirection = FlowDirection.TopDown
            };
            // khi thÃªm khá»‘i táº§ng má»›i thÃ¬ tá»± chá»‰nh láº¡i width
            flowRooms.ControlAdded += new ControlEventHandler(this.flowRooms_ControlAdded);

            // Panel chi tiáº¿t phÃ²ng (bÃªn pháº£i, náº¿u báº¡n dÃ¹ng side panel)
            panelDetailHost = new Panel
            {
                Dock = DockStyle.Right,
                Width = 420,
                MinimumSize = new global::System.Drawing.Size(360, 0),
                Visible = false,
                BackColor = Color.White
            };

            panelCenter.Controls.Add(flowRooms);
            panelCenter.Controls.Add(panelDetailHost);

            panelMain.Controls.Add(panelCenter);
            panelMain.Controls.Add(panelFilter);

            // ===== ADD VÃ€O FORM =====
            this.Controls.Add(panelMain);
            this.Controls.Add(panelLeft);
            this.Controls.Add(panelTop);

            // ===== Helpers =====
            Button MakeLeftButton(string text, int top)
            {
                var btn = new Button
                {
                    FlatStyle = FlatStyle.Flat,
                    TextAlign = ContentAlignment.MiddleLeft,
                    Font = new Font("Segoe UI", 10F),
                    ForeColor = Color.FromArgb(55, 71, 79),
                    BackColor = Color.Transparent,
                    Text = text,
                    Width = 220,
                    Height = 36,
                    Location = new Point(0, top),
                    Padding = new Padding(20, 0, 0, 0),
                    Anchor = AnchorStyles.Top | AnchorStyles.Left | AnchorStyles.Right
                };
                btn.FlatAppearance.BorderSize = 0;
                return btn;
            }

            Button MakeFilter(string text, Color color)
            {
                var btn = new Button
                {
                    FlatStyle = FlatStyle.Flat,
                    Font = new Font("Segoe UI", 9F, FontStyle.Bold),
                    ForeColor = Color.White,
                    BackColor = color,
                    Text = text,
                    Height = 30,
                    Width = 130,
                    Margin = new Padding(5, 5, 5, 5)
                };
                btn.FlatAppearance.BorderSize = 0;
                return btn;
            }
        }
    }
}


================================================================================================
FILE PATH: Forms\RoomDetailForm.cs
================================================================================================
using System;
using System.Collections.Generic;
using System.Drawing;
using System.Drawing.Drawing2D;
using System.Globalization;
using System.Text.RegularExpressions;
using System.Windows.Forms;
using HotelManagement.Data;
using HotelManagement.Models;

namespace HotelManagement.Forms
{
    public partial class RoomDetailForm : Form
    {
        private readonly Room _room;
        private readonly RoomDAL _roomDal = new RoomDAL();
        private readonly BookingDAL _bookingDal = new BookingDAL();

        public event EventHandler BackRequested;
        public event EventHandler Saved;

        private bool _layoutApplied = false;

        // Colors
        private readonly Color clrHeaderBg = Color.FromArgb(227, 242, 253); 
        private readonly Color clrHeaderText = Color.FromArgb(25, 118, 210); 
        private readonly Color clrPrimary = Color.FromArgb(33, 150, 243);    

        public RoomDetailForm(Room room)
        {
            if (room == null) throw new ArgumentNullException(nameof(room));
            _room = room;

            InitializeComponent();
            ApplyResponsiveLayout();
        }

        private void RoomDetailForm_Load(object sender, EventArgs e)
        {
            lblTitle.Text = "Nháº­n phÃ²ng nhanh";
            lblRoomText.Text = $"{_room.MaPhong} â€¢ {(_room.LoaiPhongID == 1 ? "PhÃ²ng ÄÆ¡n" : _room.LoaiPhongID == 2 ? "PhÃ²ng ÄÃ´i" : "PhÃ²ng")}, Táº§ng {_room.Tang}";
            
            InitCombos();
            BindRoomInfo();

            dtpNhanPhong.Value = _room.ThoiGianBatDau ?? DateTime.Now;
            LoadStateFromGhiChu(_room.GhiChu);

            if (!string.IsNullOrWhiteSpace(_room.TenKhachHienThi) && string.IsNullOrWhiteSpace(txtHoTen.Text))
                txtHoTen.Text = _room.TenKhachHienThi;
        }

        private void ApplyResponsiveLayout()
        {
            if (_layoutApplied) return;
            _layoutApplied = true;

            this.TopLevel = false;
            this.FormBorderStyle = FormBorderStyle.None;
            this.Dock = DockStyle.Fill;
            this.AutoScroll = true; 
            this.BackColor = Color.White;

            this.Controls.Clear();

            // Root Table
            var root = new TableLayoutPanel
            {
                Dock = DockStyle.Fill,
                ColumnCount = 1,
                RowCount = 3,
                Padding = new Padding(0),
                BackColor = Color.White
            };
            root.RowStyles.Add(new RowStyle(SizeType.AutoSize)); 
            root.RowStyles.Add(new RowStyle(SizeType.Percent, 100f)); 
            root.RowStyles.Add(new RowStyle(SizeType.AutoSize)); 

            // 1. Header
            var header = new Panel
            {
                Dock = DockStyle.Fill,
                AutoSize = true,
                Padding = new Padding(15, 10, 15, 10),
                BackColor = Color.White
            };
            var headerTable = new TableLayoutPanel { Dock = DockStyle.Top, AutoSize = true, ColumnCount = 2, RowCount = 1 };
            headerTable.ColumnStyles.Add(new ColumnStyle(SizeType.Percent, 100f));
            headerTable.ColumnStyles.Add(new ColumnStyle(SizeType.AutoSize));

            var pnlTitle = new FlowLayoutPanel { FlowDirection = FlowDirection.TopDown, AutoSize = true };
            lblTitle.Font = new Font("Segoe UI", 16F, FontStyle.Bold);
            lblTitle.ForeColor = Color.FromArgb(33, 33, 33);
            lblTitle.AutoSize = true;

            lblRoomText.Font = new Font("Segoe UI", 10F);
            lblRoomText.ForeColor = Color.Gray;
            lblRoomText.AutoSize = true;

            pnlTitle.Controls.Add(lblTitle);
            pnlTitle.Controls.Add(lblRoomText);

            btnCloseTop.Text = "âœ•"; 
            btnCloseTop.Font = new Font("Arial", 14F, FontStyle.Regular);
            btnCloseTop.FlatStyle = FlatStyle.Flat;
            btnCloseTop.FlatAppearance.BorderSize = 0;
            btnCloseTop.ForeColor = Color.Gray;
            btnCloseTop.Size = new Size(40, 40);
            btnCloseTop.Cursor = Cursors.Hand;
            btnCloseTop.Click -= btnDong_Click;
            btnCloseTop.Click += btnDong_Click;

            headerTable.Controls.Add(pnlTitle, 0, 0);
            headerTable.Controls.Add(btnCloseTop, 1, 0);
            header.Controls.Add(headerTable);

            // 2. Content
            var contentPanel = new Panel
            {
                Dock = DockStyle.Fill,
                AutoScroll = true,
                Padding = new Padding(10)
            };
            var innerContent = new TableLayoutPanel 
            {
                Dock = DockStyle.Top,
                AutoSize = true,
                ColumnCount = 1,
                Padding = new Padding(0,0,15,0)
            };
            innerContent.ColumnStyles.Add(new ColumnStyle(SizeType.Percent, 100f));

            // Section 1: Luu Tru (Using IconHelper)
            var pnlLuuTruHeader = CreateSectionHeader("ThÃ´ng tin lÆ°u trÃº", IconHelper.CreateHomeIcon()); 
            var pnlLuuTruBody = new Panel { Dock = DockStyle.Top, AutoSize = true, Padding = new Padding(5) };
            BuildLuuTruLayout(pnlLuuTruBody);

            // Section 2: Khach (Using IconHelper)
            var pnlKhachHeader = CreateSectionHeader("ThÃ´ng tin khÃ¡ch", IconHelper.CreateUserIcon());
            
            var pnlKhachButtons = new Panel { Dock = DockStyle.Top, Height = 45, Padding = new Padding(5) };
            StyleButton(btnThemKhach, true); btnThemKhach.Width = 110;
            StyleButton(btnLamMoi, false); btnLamMoi.Width = 100;
            StyleButton(btnQuetMa, true); btnQuetMa.Width = 110;
            
            btnThemKhach.Dock = DockStyle.Left;
            var spacer = new Panel { Dock = DockStyle.Left, Width = 10 };
            btnLamMoi.Dock = DockStyle.Left;
            btnQuetMa.Dock = DockStyle.Right;

            pnlKhachButtons.Controls.Add(btnLamMoi);
            pnlKhachButtons.Controls.Add(spacer);
            pnlKhachButtons.Controls.Add(btnThemKhach);
            pnlKhachButtons.Controls.Add(btnQuetMa);

            var pnlKhachBody = new Panel { Dock = DockStyle.Top, AutoSize = true, Padding = new Padding(5) };
            BuildKhachLayout(pnlKhachBody);

            // Section 3: List (Using IconHelper)
            var pnlListHeader = CreateSectionHeader("Danh sÃ¡ch khÃ¡ch", IconHelper.CreateListIcon());
            var pnlListBody = new Panel { Dock = DockStyle.Top, Height = 120, Padding = new Padding(5) };
            lstKhach.Dock = DockStyle.Fill;
            lstKhach.BorderStyle = BorderStyle.FixedSingle;
            lstKhach.Font = new Font("Segoe UI", 10F);
            pnlListBody.Controls.Add(lstKhach);

            innerContent.Controls.Add(pnlLuuTruHeader, 0, 0);
            innerContent.Controls.Add(pnlLuuTruBody, 0, 1);
            innerContent.Controls.Add(pnlKhachHeader, 0, 2);
            innerContent.Controls.Add(pnlKhachButtons, 0, 3);
            innerContent.Controls.Add(pnlKhachBody, 0, 4);
            innerContent.Controls.Add(pnlListHeader, 0, 5);
            innerContent.Controls.Add(pnlListBody, 0, 6);
            contentPanel.Controls.Add(innerContent);

            // 3. Footer
            var footer = new Panel
            {
                Dock = DockStyle.Fill,
                Height = 60,
                Padding = new Padding(15, 10, 15, 10),
                BackColor = Color.WhiteSmoke
            };
            StyleButton(btnNhanPhong, true);
            btnNhanPhong.Width = 120;
            btnNhanPhong.Dock = DockStyle.Right;
            
            StyleButton(btnDong, false);
            btnDong.Width = 100;
            btnDong.Dock = DockStyle.Right;
            var footerSpacer = new Panel { Dock = DockStyle.Right, Width = 10 };

            footer.Controls.Add(btnNhanPhong);
            footer.Controls.Add(footerSpacer);
            footer.Controls.Add(btnDong);

            root.Controls.Add(header, 0, 0);
            root.Controls.Add(contentPanel, 0, 1);
            root.Controls.Add(footer, 0, 2);
            this.Controls.Add(root);
        }

        private Panel CreateSectionHeader(string title, Image icon)
        {
            var p = new Panel
            {
                Height = 36,
                BackColor = clrHeaderBg,
                Margin = new Padding(0, 10, 0, 0)
            };
            if (icon != null)
            {
                var pic = new PictureBox
                {
                    Image = icon,
                    SizeMode = PictureBoxSizeMode.AutoSize,
                    Location = new Point(10, 6),
                    BackColor = Color.Transparent
                };
                p.Controls.Add(pic);
            }
            var lbl = new Label
            {
                Text = title,
                Font = new Font("Segoe UI", 10F, FontStyle.Bold),
                ForeColor = clrHeaderText,
                AutoSize = true,
                Location = new Point(40, 8) 
            };
            p.Controls.Add(lbl);
            return p;
        }

        private void BuildLuuTruLayout(Panel container)
        {
            var tbl = new TableLayoutPanel
            {
                Dock = DockStyle.Top,
                AutoSize = true,
                ColumnCount = 4,
                Padding = new Padding(0),
                Margin = new Padding(0)
            };
            for(int i=0; i<4; i++) tbl.ColumnStyles.Add(new ColumnStyle(SizeType.Percent, 25f));

            AddCell(tbl, lblNhanPhong, dtpNhanPhong, 0, 0);
            AddCell(tbl, lblTraPhong, dtpTraPhong, 1, 0);
            AddCell(tbl, lblLyDo, cboLyDoLuuTru, 2, 0, 2);

            AddCell(tbl, lblLoaiPhong, cboLoaiPhong, 0, 1);
            AddCell(tbl, lblPhong, cboPhong, 1, 1);
            AddCell(tbl, new Label { Text = "Loáº¡i giÃ¡ :" }, cboLoaiGia, 2, 1);
            AddCell(tbl, lblGiaPhong, txtGiaPhong, 3, 1);

            AddCell(tbl, new Label { Text = "Ghi chÃº :" }, txtGhiChuLuuTru, 0, 2, 4);
            container.Controls.Add(tbl);
        }

        private void BuildKhachLayout(Panel container)
        {
            var tbl = new TableLayoutPanel
            {
                Dock = DockStyle.Top,
                AutoSize = true,
                ColumnCount = 3,
                Padding = new Padding(0),
                Margin = new Padding(0)
            };
            for(int i=0; i<3; i++) tbl.ColumnStyles.Add(new ColumnStyle(SizeType.Percent, 33.33f));

            AddCell(tbl, lblHoTen, txtHoTen, 0, 0);
            AddCell(tbl, lblGioiTinh, cboGioiTinh, 1, 0);
            AddCell(tbl, lblNgaySinh, dtpNgaySinh, 2, 0);

            AddCell(tbl, lblDienThoai, txtDienThoai, 0, 1);
            AddCell(tbl, lblLoaiGiayTo, cboLoaiGiayTo, 1, 1);
            
            var pnlGiayTo = new Panel { Dock = DockStyle.Top, Height = 30, BorderStyle = BorderStyle.FixedSingle };
            var btnSearchGT = new Button 
            { 
                Dock = DockStyle.Right, 
                Width = 30, 
                Image = IconHelper.CreateSearchIcon(),
                FlatStyle = FlatStyle.Flat, 
                BackColor = Color.White, 
                Cursor = Cursors.Hand 
            };
            btnSearchGT.FlatAppearance.BorderSize = 0;
            txtSoGiayTo.BorderStyle = BorderStyle.None;
            txtSoGiayTo.Dock = DockStyle.Fill;
            var pnlTxtWrapper = new Panel { Dock = DockStyle.Fill, Padding = new Padding(3,5,0,0), BackColor = Color.White };
            pnlTxtWrapper.Controls.Add(txtSoGiayTo);
            pnlGiayTo.Controls.Add(pnlTxtWrapper);
            pnlGiayTo.Controls.Add(btnSearchGT);

            var pCellGT = CreateCellPanel(lblSoGiayTo, pnlGiayTo);
            tbl.Controls.Add(pCellGT, 2, 1);

            AddCell(tbl, lblQuocTich, cboQuocTich, 0, 2);
            AddCell(tbl, lblGhiChuKhach, txtGhiChuKhach, 1, 2, 2);

            var pnlCuTru = CreateRadioPanel(rdoThuongTru, rdoTamTru, rdoNoiKhac);
            AddCell(tbl, lblNoiCuTru, pnlCuTru, 0, 3, 3);

            var pnlDiaBan = CreateRadioPanel(rdoDiaBanMoi, rdoDiaBanCu);
            AddCell(tbl, lblLoaiDiaBan, pnlDiaBan, 0, 4, 3);

            AddCell(tbl, lblTinhThanh, cboTinhThanh, 0, 5);
            AddCell(tbl, lblPhuongXa, cboPhuongXa, 1, 5);
            AddCell(tbl, lblDiaChiChiTiet, txtDiaChiChiTiet, 2, 5);

            AddCell(tbl, lblNgheNghiep, cboNgheNghiep, 0, 6);
            AddCell(tbl, lblNoiLamViec, txtNoiLamViec, 1, 6, 2);

            container.Controls.Add(tbl);
        }

        private Panel CreateCellPanel(Control label, Control input)
        {
            var p = new Panel { Dock = DockStyle.Fill, Margin = new Padding(5, 5, 5, 10), AutoSize = true };
            label.Dock = DockStyle.Top;
            label.AutoSize = true;
            label.Font = new Font("Segoe UI", 9F);
            label.ForeColor = Color.Black;
            label.Padding = new Padding(0, 0, 0, 4);
            if (label.Text.Contains("*")) label.ForeColor = Color.Black; 

            input.Dock = DockStyle.Top;
            if (!(input is Panel) && !(input is FlowLayoutPanel)) StyleControl(input);
            p.Controls.Add(input);
            p.Controls.Add(label);
            return p;
        }

        private void AddCell(TableLayoutPanel tbl, Control lbl, Control ctrl, int col, int row, int colSpan = 1)
        {
            var p = CreateCellPanel(lbl, ctrl);
            tbl.Controls.Add(p, col, row);
            if (colSpan > 1) tbl.SetColumnSpan(p, colSpan);
        }

        private Panel CreateRadioPanel(params RadioButton[] radios)
        {
            var p = new FlowLayoutPanel
            {
                Dock = DockStyle.Top,
                AutoSize = true,
                FlowDirection = FlowDirection.LeftToRight,
                WrapContents = true,
                Padding = new Padding(0, 5, 0, 0)
            };
            foreach (var r in radios)
            {
                r.AutoSize = true;
                r.Margin = new Padding(0, 0, 20, 0);
                r.Font = new Font("Segoe UI", 9.5f);
                p.Controls.Add(r);
            }
            return p;
        }

        private void StyleControl(Control c)
        {
            c.Font = new Font("Segoe UI", 10F);
            if (c is TextBox txt) 
            { 
                txt.BorderStyle = BorderStyle.FixedSingle;
                txt.Height = 30;
                if (txt.Multiline) txt.Height = 60;
            }
            else if (c is ComboBox cb) { cb.FlatStyle = FlatStyle.System; cb.Height = 30; }
            else if (c is DateTimePicker dt) { dt.Height = 30; }
        }

        private void StyleButton(Button b, bool primary)
        {
            b.FlatStyle = FlatStyle.Flat;
            b.FlatAppearance.BorderSize = primary ? 0 : 1;
            b.FlatAppearance.BorderColor = clrPrimary;
            b.BackColor = primary ? clrPrimary : Color.White;
            b.ForeColor = primary ? Color.White : clrPrimary;
            b.Cursor = Cursors.Hand;
            b.Height = 36;
            b.Font = new Font("Segoe UI", 9.5F, FontStyle.Bold);
        }

        private void InitCombos()
        {
            cboLyDoLuuTru.Items.Clear();
            cboLyDoLuuTru.Items.AddRange(new object[] { "-- Chá»n --", "Du lá»‹ch", "CÃ´ng tÃ¡c", "ThÄƒm thÃ¢n", "KhÃ¡c" });
            cboLyDoLuuTru.SelectedIndex = 0;
            cboLoaiGia.Items.Clear();
            cboLoaiGia.Items.AddRange(new object[] { "Máº·c Ä‘á»‹nh", "Theo giá»", "Theo ngÃ y", "KhÃ¡c" });
            cboLoaiGia.SelectedIndex = 0;
            cboGioiTinh.Items.Clear();
            cboGioiTinh.Items.AddRange(new object[] { "-- Chá»n --", "Nam", "Ná»¯", "KhÃ¡c" });
            cboGioiTinh.SelectedIndex = 0;
            cboLoaiGiayTo.Items.Clear();
            cboLoaiGiayTo.Items.AddRange(new object[] { "Tháº» CCCD", "CMND", "Há»™ chiáº¿u" });
            cboLoaiGiayTo.SelectedIndex = 0;
            cboQuocTich.Items.Clear();
            cboQuocTich.Items.AddRange(new object[] { "VNM - Viá»‡t Nam","USA - United States","KOR - Korea","JPN - Japan","CHN - China", "OTHER" });
            cboQuocTich.SelectedIndex = 0;
            cboTinhThanh.Items.Clear();
            cboTinhThanh.Items.AddRange(new object[] { "Chá»n Tá»‰nh/ThÃ nh", "HÃ  Ná»™i", "TP. Há»“ ChÃ­ Minh", "ÄÃ  Náºµng", "Cáº§n ThÆ¡", "KhÃ¡c" });
            cboTinhThanh.SelectedIndex = 0;
            cboPhuongXa.Items.Clear();
            cboPhuongXa.Items.AddRange(new object[] { "Chá»n PhÆ°á»ng/XÃ£", "PhÆ°á»ng 1", "PhÆ°á»ng 2", "XÃ£ A", "XÃ£ B" });
            cboPhuongXa.SelectedIndex = 0;
            cboNgheNghiep.Items.Clear();
            cboNgheNghiep.Items.AddRange(new object[] { "-- Chá»n --", "CÃ´ng nhÃ¢n", "NhÃ¢n viÃªn VP", "Tá»± do", "Há»c sinh/SV" });
            cboNgheNghiep.SelectedIndex = 0;
            rdoThuongTru.Checked = true;
            rdoDiaBanMoi.Checked = true;
            if (dtpNgaySinh.Value.Year < 1900) dtpNgaySinh.Value = new DateTime(1990, 1, 1);
        }

        private void BindRoomInfo()
        {
            cboLoaiPhong.Items.Clear();
            cboLoaiPhong.Items.Add(_room.LoaiPhongID == 1 ? "PhÃ²ng ÄÆ¡n" : _room.LoaiPhongID == 2 ? "PhÃ²ng ÄÃ´i" : "PhÃ²ng");
            cboLoaiPhong.SelectedIndex = 0;
            cboLoaiPhong.Enabled = false;
            cboPhong.Items.Clear();
            cboPhong.Items.Add("PhÃ²ng " + _room.MaPhong);
            cboPhong.SelectedIndex = 0;
            cboPhong.Enabled = false;
            try
            {
                decimal gia = _bookingDal.GetDonGiaNgayByPhong(_room.PhongID);
                if (gia <= 0) gia = (_room.LoaiPhongID == 1) ? 250000m : 350000m;
                txtGiaPhong.Text = gia.ToString("N0");
            }
            catch { txtGiaPhong.Text = "0"; }
        }

        private void btnDong_Click(object sender, EventArgs e) { BackRequested?.Invoke(this, EventArgs.Empty); }
        private void btnQuetMa_Click(object sender, EventArgs e) { MessageBox.Show("Chá»©c nÄƒng quÃ©t mÃ£ sáº½ Ä‘Æ°á»£c bá»• sung sau.", "ThÃ´ng bÃ¡o"); }

        private void btnNhanPhong_Click(object sender, EventArgs e)
        {
            if (!ValidateForm()) return;
            string tenChinh = GetPrimaryGuestName();
            _room.TrangThai = 1; 
            _room.KieuThue = (_room.KieuThue.HasValue && _room.KieuThue.Value > 0) ? _room.KieuThue : 1;
            _room.ThoiGianBatDau = dtpNhanPhong.Value;
            _room.TenKhachHienThi = tenChinh;
            string ghiChu = BuildGhiChuForSave();
            _roomDal.UpdateTrangThaiFull(_room.PhongID, _room.TrangThai, ghiChu, _room.ThoiGianBatDau, _room.KieuThue, _room.TenKhachHienThi);
            _room.GhiChu = ghiChu;
            Saved?.Invoke(this, EventArgs.Empty);
            BackRequested?.Invoke(this, EventArgs.Empty);
        }

        private bool ValidateForm()
        {
            if (cboLyDoLuuTru.SelectedIndex <= 0) { MessageBox.Show("Vui lÃ²ng chá»n LÃ½ do lÆ°u trÃº.", "Thiáº¿u thÃ´ng tin", MessageBoxButtons.OK, MessageBoxIcon.Warning); cboLyDoLuuTru.Focus(); return false; }
            if (string.IsNullOrWhiteSpace(GetPrimaryGuestName())) { MessageBox.Show("Vui lÃ²ng nháº­p Há» tÃªn.", "Thiáº¿u thÃ´ng tin", MessageBoxButtons.OK, MessageBoxIcon.Warning); txtHoTen.Focus(); return false; }
            return true;
        }

        private string GetPrimaryGuestName()
        {
            if (lstKhach.Items.Count > 0)
            {
                string item = lstKhach.Items[0]?.ToString() ?? "";
                if (!string.IsNullOrWhiteSpace(item))
                {
                    int idx = item.IndexOf(" - ", StringComparison.Ordinal);
                    return idx > 0 ? item.Substring(0, idx).Trim() : item.Trim();
                }
            }
            return (txtHoTen.Text ?? "").Trim();
        }

        private void btnThemKhach_Click(object sender, EventArgs e)
        {
            if (string.IsNullOrWhiteSpace(txtHoTen.Text)) return;
            string display = $"{txtHoTen.Text.Trim()} - {txtSoGiayTo.Text.Trim()}";
            lstKhach.Items.Add(display);
            txtHoTen.SelectAll();
            txtHoTen.Focus();
        }

        private void btnLamMoi_Click(object sender, EventArgs e)
        {
            txtHoTen.Text = ""; cboGioiTinh.SelectedIndex = 0; dtpNgaySinh.Value = new DateTime(1990, 1, 1);
            txtDienThoai.Text = ""; txtSoGiayTo.Text = ""; txtGhiChuKhach.Text = "";
            cboNgheNghiep.SelectedIndex = 0; txtNoiLamViec.Text = "";
            cboTinhThanh.SelectedIndex = 0; cboPhuongXa.SelectedIndex = 0; txtDiaChiChiTiet.Text = "";
        }

        private string BuildGhiChuForSave()
        {
            var tags = new List<string>();
            tags.Add("LYDO=" + SafeTagValue(cboLyDoLuuTru.SelectedItem?.ToString()));
            tags.Add("GT=" + SafeTagValue(cboGioiTinh.SelectedItem?.ToString()));
            tags.Add("NS=" + dtpNgaySinh.Value.ToString("yyyyMMdd"));
            tags.Add("LGT=" + SafeTagValue(cboLoaiGiayTo.SelectedItem?.ToString()));
            tags.Add("SGT=" + SafeTagValue(txtSoGiayTo.Text.Trim()));
            tags.Add("QT=" + SafeTagValue(cboQuocTich.SelectedItem?.ToString()));
            tags.Add("SDT=" + SafeTagValue(txtDienThoai.Text));
            tags.Add("JOB=" + SafeTagValue(cboNgheNghiep.SelectedItem?.ToString()));
            tags.Add("WORK=" + SafeTagValue(txtNoiLamViec.Text));
            if (!string.IsNullOrWhiteSpace(txtGhiChuLuuTru.Text)) tags.Add("NOTE_S=" + SafeTagValue(txtGhiChuLuuTru.Text));
            if (!string.IsNullOrWhiteSpace(txtGhiChuKhach.Text)) tags.Add("NOTE_G=" + SafeTagValue(txtGhiChuKhach.Text));
            if (dtpTraPhong.Checked) tags.Add("TRAP=" + dtpTraPhong.Value.ToString("yyyyMMdd"));
            if (lstKhach.Items.Count > 0)
            {
                var guests = new List<string>();
                foreach (var it in lstKhach.Items) {
                    if (it == null) continue;
                    string s = it.ToString().Trim();
                    if (s.Length > 0) guests.Add(SafeTagValue(s));
                }
                if (guests.Count > 0) tags.Add("DSK=" + string.Join(";", guests));
            }
            return string.Join(" | ", tags);
        }

        private static string SafeTagValue(string s)
        {
            s = (s ?? "").Trim();
            if (s.Length == 0) return "";
            s = s.Replace("|", "/");
            s = Regex.Replace(s, @"\s+", " ");
            return s;
        }

        private static string GetStringTag(string text, string key, string defaultVal)
        {
            if (string.IsNullOrEmpty(text)) return defaultVal;
            Match m = Regex.Match(text, @"\b" + Regex.Escape(key) + @"\s*=\s*([^|]+)", RegexOptions.IgnoreCase);
            if (m.Success) return m.Groups[1].Value.Trim();
            return defaultVal;
        }

        private void LoadStateFromGhiChu(string ghiChu)
        {
            if (string.IsNullOrWhiteSpace(ghiChu)) return;
            SelectComboByText(cboLyDoLuuTru, GetStringTag(ghiChu, "LYDO", ""));
            SelectComboByText(cboGioiTinh, GetStringTag(ghiChu, "GT", ""));
            string ns = GetStringTag(ghiChu, "NS", "");
            if (ns.Length == 8 && DateTime.TryParseExact(ns, "yyyyMMdd", CultureInfo.InvariantCulture, DateTimeStyles.None, out var dob)) dtpNgaySinh.Value = dob;
            txtSoGiayTo.Text = GetStringTag(ghiChu, "SGT", "");
            txtDienThoai.Text = GetStringTag(ghiChu, "SDT", "");
            txtNoiLamViec.Text = GetStringTag(ghiChu, "WORK", "");
            SelectComboByText(cboNgheNghiep, GetStringTag(ghiChu, "JOB", ""));
            txtGhiChuLuuTru.Text = GetStringTag(ghiChu, "NOTE_S", "");
            txtGhiChuKhach.Text = GetStringTag(ghiChu, "NOTE_G", "");
            string dsk = GetStringTag(ghiChu, "DSK", "");
            if (!string.IsNullOrWhiteSpace(dsk)) {
                var parts = dsk.Split(new[] { ';' }, StringSplitOptions.RemoveEmptyEntries);
                foreach (var p in parts) lstKhach.Items.Add(p.Trim());
            }
        }

        private static void SelectComboByText(ComboBox cbo, string text)
        {
            if (cbo == null || cbo.Items.Count == 0 || string.IsNullOrWhiteSpace(text)) return;
            for (int i = 0; i < cbo.Items.Count; i++) {
                string it = cbo.Items[i]?.ToString() ?? "";
                if (string.Equals(it, text, StringComparison.OrdinalIgnoreCase)) { cbo.SelectedIndex = i; return; }
            }
        }
    }

    // IconHelper class definition
    public static class IconHelper
    {
        private static readonly Color PrimaryColor = Color.FromArgb(25, 118, 210);

        public static Bitmap CreateHomeIcon(int size = 24)
        {
            var bmp = new Bitmap(size, size);
            using (var g = Graphics.FromImage(bmp))
            {
                g.SmoothingMode = SmoothingMode.AntiAlias;
                using (var brush = new SolidBrush(PrimaryColor))
                {
                    Point[] roof = { new Point(size / 2, 2), new Point(2, size / 2 + 2), new Point(size - 2, size / 2 + 2) };
                    g.FillPolygon(brush, roof);
                    g.FillRectangle(brush, 5, size / 2 + 2, size - 10, size / 2 - 2);
                }
            }
            return bmp;
        }

        public static Bitmap CreateUserIcon(int size = 24)
        {
            var bmp = new Bitmap(size, size);
            using (var g = Graphics.FromImage(bmp))
            {
                g.SmoothingMode = SmoothingMode.AntiAlias;
                using (var brush = new SolidBrush(PrimaryColor))
                {
                    int headSize = size / 2 - 2;
                    g.FillEllipse(brush, (size - headSize) / 2, 2, headSize, headSize);
                    int bodyH = size / 2;
                    g.FillPie(brush, 2, size - bodyH - 2, size - 4, bodyH * 2, 180, 180);
                }
            }
            return bmp;
        }

        public static Bitmap CreateListIcon(int size = 24)
        {
            var bmp = new Bitmap(size, size);
            using (var g = Graphics.FromImage(bmp))
            {
                g.SmoothingMode = SmoothingMode.None;
                using (var brush = new SolidBrush(PrimaryColor))
                {
                    int h = 4; int gap = 3; int y = 4;
                    g.FillRectangle(brush, 4, y, size - 8, h);
                    g.FillRectangle(brush, 4, y + h + gap, size - 8, h);
                    g.FillRectangle(brush, 4, y + (h + gap) * 2, size - 12, h);
                }
            }
            return bmp;
        }

        public static Bitmap CreateSearchIcon(int size = 16)
        {
            var bmp = new Bitmap(size, size);
            using (var g = Graphics.FromImage(bmp))
            {
                g.SmoothingMode = SmoothingMode.AntiAlias;
                using (var pen = new Pen(Color.Gray, 2))
                {
                    g.DrawEllipse(pen, 2, 2, 8, 8);
                    g.DrawLine(pen, 9, 9, 13, 13);
                }
            }
            return bmp;
        }
    }
}


================================================================================================
FILE PATH: Forms\RoomDetailForm.Designer.cs
================================================================================================
using System;
using System.Drawing;
using System.Windows.Forms;

namespace HotelManagement.Forms
{
    partial class RoomDetailForm
    {
        private System.ComponentModel.IContainer components = null;

        private Label lblTitle;
        private Label lblRoomText;
        private Button btnCloseTop;

        private Label lblNhanPhong;
        private DateTimePicker dtpNhanPhong;
        private Label lblTraPhong;
        private DateTimePicker dtpTraPhong;
        private Label lblLyDo;
        private ComboBox cboLyDoLuuTru;
        
        private Label lblLoaiPhong;
        private ComboBox cboLoaiPhong;
        private Label lblPhong;
        private ComboBox cboPhong;
        
        private ComboBox cboLoaiGia;
        private Label lblGiaPhong;
        private TextBox txtGiaPhong;
        private TextBox txtGhiChuLuuTru;

        private Button btnThemKhach;
        private Button btnLamMoi;
        private Button btnQuetMa;

        private Label lblHoTen;
        private TextBox txtHoTen;
        private Label lblGioiTinh;
        private ComboBox cboGioiTinh;
        private Label lblNgaySinh;
        private DateTimePicker dtpNgaySinh;
        
        private Label lblDienThoai; 
        private TextBox txtDienThoai;
        private Label lblLoaiGiayTo;
        private ComboBox cboLoaiGiayTo;
        private Label lblSoGiayTo;
        private TextBox txtSoGiayTo;
        
        private Label lblQuocTich;
        private ComboBox cboQuocTich;
        private Label lblGhiChuKhach;
        private TextBox txtGhiChuKhach;

        private Label lblNoiCuTru;
        private RadioButton rdoThuongTru;
        private RadioButton rdoTamTru;
        private RadioButton rdoNoiKhac;

        private Label lblLoaiDiaBan;
        private RadioButton rdoDiaBanMoi;
        private RadioButton rdoDiaBanCu;

        private Label lblTinhThanh;
        private ComboBox cboTinhThanh;
        private Label lblPhuongXa;
        private ComboBox cboPhuongXa;
        private Label lblDiaChiChiTiet;
        private TextBox txtDiaChiChiTiet;
        
        private Label lblNgheNghiep;
        private ComboBox cboNgheNghiep;
        private Label lblNoiLamViec;
        private TextBox txtNoiLamViec;

        private ListBox lstKhach;
        private Button btnDong;
        private Button btnNhanPhong;

        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null)) components.Dispose();
            base.Dispose(disposing);
        }

        private void InitializeComponent()
        {
            this.components = new System.ComponentModel.Container();
            
            this.lblTitle = new Label();
            this.lblRoomText = new Label();
            this.btnCloseTop = new Button();
            
            this.lblNhanPhong = new Label { Text = "Thá»i gian nháº­n phÃ²ng *" };
            this.dtpNhanPhong = new DateTimePicker { Format = DateTimePickerFormat.Custom, CustomFormat = "dd/MM/yyyy HH:mm" };
            this.lblTraPhong = new Label { Text = "Thá»i gian tráº£ phÃ²ng" };
            this.dtpTraPhong = new DateTimePicker { Format = DateTimePickerFormat.Custom, CustomFormat = "dd/MM/yyyy", ShowCheckBox = true, Checked = false };
            this.lblLyDo = new Label { Text = "LÃ½ do lÆ°u trÃº *" };
            this.cboLyDoLuuTru = new ComboBox { DropDownStyle = ComboBoxStyle.DropDownList };
            
            this.lblLoaiPhong = new Label { Text = "Loáº¡i phÃ²ng *" };
            this.cboLoaiPhong = new ComboBox { DropDownStyle = ComboBoxStyle.DropDownList };
            this.lblPhong = new Label { Text = "PhÃ²ng *" };
            this.cboPhong = new ComboBox { DropDownStyle = ComboBoxStyle.DropDownList };
            this.cboLoaiGia = new ComboBox { DropDownStyle = ComboBoxStyle.DropDownList };
            this.lblGiaPhong = new Label { Text = "GiÃ¡ phÃ²ng" };
            this.txtGiaPhong = new TextBox();
            this.txtGhiChuLuuTru = new TextBox { Multiline = true };

            this.btnThemKhach = new Button { Text = "ThÃªm khÃ¡ch" };
            this.btnLamMoi = new Button { Text = "LÃ m má»›i" };
            this.btnQuetMa = new Button { Text = "QuÃ©t mÃ£ (F1)" };
            
            this.lblHoTen = new Label { Text = "Há» tÃªn *" };
            this.txtHoTen = new TextBox();
            this.lblGioiTinh = new Label { Text = "Giá»›i tÃ­nh *" };
            this.cboGioiTinh = new ComboBox { DropDownStyle = ComboBoxStyle.DropDownList };
            this.lblNgaySinh = new Label { Text = "NgÃ y sinh *" };
            this.dtpNgaySinh = new DateTimePicker { Format = DateTimePickerFormat.Custom, CustomFormat = "dd/MM/yyyy" };
            
            this.lblDienThoai = new Label { Text = "Sá»‘ Ä‘iá»‡n thoáº¡i" };
            this.txtDienThoai = new TextBox();
            this.lblLoaiGiayTo = new Label { Text = "Loáº¡i giáº¥y tá» *" };
            this.cboLoaiGiayTo = new ComboBox { DropDownStyle = ComboBoxStyle.DropDownList };
            this.lblSoGiayTo = new Label { Text = "Sá»‘ giáº¥y tá» *" };
            this.txtSoGiayTo = new TextBox();
            
            this.lblQuocTich = new Label { Text = "Quá»‘c tá»‹ch *" };
            this.cboQuocTich = new ComboBox { DropDownStyle = ComboBoxStyle.DropDownList };
            this.lblGhiChuKhach = new Label { Text = "Ghi chÃº" };
            this.txtGhiChuKhach = new TextBox();

            this.lblNoiCuTru = new Label { Text = "NÆ¡i cÆ° trÃº *" };
            this.rdoThuongTru = new RadioButton { Text = "ThÆ°á»ng trÃº" };
            this.rdoTamTru = new RadioButton { Text = "Táº¡m trÃº" };
            this.rdoNoiKhac = new RadioButton { Text = "KhÃ¡c" };
            
            this.lblLoaiDiaBan = new Label { Text = "Loáº¡i Ä‘á»‹a bÃ n:" };
            this.rdoDiaBanMoi = new RadioButton { Text = "Äá»‹a bÃ n má»›i" };
            this.rdoDiaBanCu = new RadioButton { Text = "Äá»‹a bÃ n cÅ©" };
            
            this.lblTinhThanh = new Label { Text = "Tá»‰nh/ ThÃ nh phá»‘ *" };
            this.cboTinhThanh = new ComboBox { DropDownStyle = ComboBoxStyle.DropDownList };
            this.lblPhuongXa = new Label { Text = "PhÆ°á»ng/ XÃ£/ Äáº·c khu *" };
            this.cboPhuongXa = new ComboBox { DropDownStyle = ComboBoxStyle.DropDownList };
            this.lblDiaChiChiTiet = new Label { Text = "Äá»‹a chá»‰ chi tiáº¿t *" };
            this.txtDiaChiChiTiet = new TextBox();
            
            this.lblNgheNghiep = new Label { Text = "Nghá» nghiá»‡p :" };
            this.cboNgheNghiep = new ComboBox { DropDownStyle = ComboBoxStyle.DropDownList };
            this.lblNoiLamViec = new Label { Text = "NÆ¡i lÃ m viá»‡c :" };
            this.txtNoiLamViec = new TextBox();

            this.lstKhach = new ListBox();
            this.btnDong = new Button { Text = "ÄÃ³ng" };
            this.btnNhanPhong = new Button { Text = "Nháº­n phÃ²ng" };

            this.AutoScaleMode = AutoScaleMode.Font;
            this.ClientSize = new Size(1100, 700);
            this.Load += new EventHandler(this.RoomDetailForm_Load);
        }
    }
}


================================================================================================
FILE PATH: Hotel Management.csproj
================================================================================================
<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="15.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="packages\EntityFramework.6.5.1\build\EntityFramework.props" Condition="Exists('packages\EntityFramework.6.5.1\build\EntityFramework.props')" />
  <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')" />
  <PropertyGroup>
    <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>
    <Platform Condition=" '$(Platform)' == '' ">AnyCPU</Platform>
    <ProjectGuid>{D57C892D-E5F8-426C-AB1D-E884C583FFAF}</ProjectGuid>
    <OutputType>WinExe</OutputType>
    <RootNamespace>Hotel_Management</RootNamespace>
    <AssemblyName>Hotel Management</AssemblyName>
    <TargetFrameworkVersion>v4.8</TargetFrameworkVersion>
    <FileAlignment>512</FileAlignment>
    <AutoGenerateBindingRedirects>true</AutoGenerateBindingRedirects>
    <Deterministic>true</Deterministic>
    <NuGetPackageImportStamp>
    </NuGetPackageImportStamp>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
    <PlatformTarget>AnyCPU</PlatformTarget>
    <DebugSymbols>true</DebugSymbols>
    <DebugType>full</DebugType>
    <Optimize>false</Optimize>
    <OutputPath>bin\Debug\</OutputPath>
    <DefineConstants>DEBUG;TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
    <PlatformTarget>AnyCPU</PlatformTarget>
    <DebugType>pdbonly</DebugType>
    <Optimize>true</Optimize>
    <OutputPath>bin\Release\</OutputPath>
    <DefineConstants>TRACE</DefineConstants>
    <ErrorReport>prompt</ErrorReport>
    <WarningLevel>4</WarningLevel>
  </PropertyGroup>
  <PropertyGroup>
    <StartupObject>HotelManagement.Program</StartupObject>
  </PropertyGroup>
  <ItemGroup>
    <Reference Include="BouncyCastle.Crypto, Version=1.8.5.0, Culture=neutral, PublicKeyToken=0e99375e54769942">
      <HintPath>packages\BouncyCastle.1.8.5\lib\BouncyCastle.Crypto.dll</HintPath>
    </Reference>
    <Reference Include="BouncyCastle.Cryptography, Version=2.0.0.0, Culture=neutral, PublicKeyToken=072edcf4a5328938, processorArchitecture=MSIL">
      <HintPath>packages\BouncyCastle.Cryptography.2.6.2\lib\net461\BouncyCastle.Cryptography.dll</HintPath>
    </Reference>
    <Reference Include="EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089, processorArchitecture=MSIL">
      <HintPath>packages\EntityFramework.6.5.1\lib\net45\EntityFramework.dll</HintPath>
    </Reference>
    <Reference Include="EntityFramework.SqlServer, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089, processorArchitecture=MSIL">
      <HintPath>packages\EntityFramework.6.5.1\lib\net45\EntityFramework.SqlServer.dll</HintPath>
    </Reference>
    <Reference Include="Google.Protobuf, Version=3.32.0.0, Culture=neutral, PublicKeyToken=a7d26565bac4d604, processorArchitecture=MSIL">
      <HintPath>packages\Google.Protobuf.3.32.0\lib\net45\Google.Protobuf.dll</HintPath>
    </Reference>
    <Reference Include="K4os.Compression.LZ4, Version=1.2.16.0, Culture=neutral, PublicKeyToken=2186fa9121ef231d, processorArchitecture=MSIL">
      <HintPath>packages\K4os.Compression.LZ4.1.2.16\lib\net46\K4os.Compression.LZ4.dll</HintPath>
    </Reference>
    <Reference Include="K4os.Compression.LZ4.Streams, Version=1.2.16.0, Culture=neutral, PublicKeyToken=2186fa9121ef231d, processorArchitecture=MSIL">
      <HintPath>packages\K4os.Compression.LZ4.Streams.1.2.16\lib\net46\K4os.Compression.LZ4.Streams.dll</HintPath>
    </Reference>
    <Reference Include="K4os.Hash.xxHash, Version=1.0.7.0, Culture=neutral, PublicKeyToken=32cd54395057cec3, processorArchitecture=MSIL">
      <HintPath>packages\K4os.Hash.xxHash.1.0.7\lib\net46\K4os.Hash.xxHash.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Bcl.AsyncInterfaces, Version=8.0.0.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51, processorArchitecture=MSIL">
      <HintPath>packages\Microsoft.Bcl.AsyncInterfaces.8.0.0\lib\net462\Microsoft.Bcl.AsyncInterfaces.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Extensions.DependencyInjection.Abstractions, Version=8.0.0.2, Culture=neutral, PublicKeyToken=adb9793829ddae60, processorArchitecture=MSIL">
      <HintPath>packages\Microsoft.Extensions.DependencyInjection.Abstractions.8.0.2\lib\net462\Microsoft.Extensions.DependencyInjection.Abstractions.dll</HintPath>
    </Reference>
    <Reference Include="Microsoft.Extensions.Logging.Abstractions, Version=8.0.0.3, Culture=neutral, PublicKeyToken=adb9793829ddae60, processorArchitecture=MSIL">
      <HintPath>packages\Microsoft.Extensions.Logging.Abstractions.8.0.3\lib\net462\Microsoft.Extensions.Logging.Abstractions.dll</HintPath>
    </Reference>
    <Reference Include="MySql.Data, Version=8.0.26.0, Culture=neutral, PublicKeyToken=c5687fc88969c44d, processorArchitecture=MSIL">
      <HintPath>packages\MySql.Data.8.0.26\lib\net48\MySql.Data.dll</HintPath>
    </Reference>
    <Reference Include="MySql.Data.EntityFramework, Version=8.0.26.0, Culture=neutral, PublicKeyToken=c5687fc88969c44d, processorArchitecture=MSIL">
      <HintPath>packages\MySql.Data.EntityFramework.8.0.26\lib\net452\MySql.Data.EntityFramework.dll</HintPath>
    </Reference>
    <Reference Include="MySqlConnector, Version=1.0.0.0, Culture=neutral, PublicKeyToken=d33d3e53aa5f8c92, processorArchitecture=MSIL">
      <HintPath>packages\MySqlConnector.1.3.14\lib\net471\MySqlConnector.dll</HintPath>
    </Reference>
    <Reference Include="System" />
    <Reference Include="System.Buffers, Version=4.0.3.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51, processorArchitecture=MSIL">
      <HintPath>packages\System.Buffers.4.5.1\lib\net461\System.Buffers.dll</HintPath>
    </Reference>
    <Reference Include="System.ComponentModel" />
    <Reference Include="System.ComponentModel.DataAnnotations" />
    <Reference Include="System.Configuration" />
    <Reference Include="System.Configuration.ConfigurationManager, Version=8.0.0.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51, processorArchitecture=MSIL">
      <HintPath>packages\System.Configuration.ConfigurationManager.8.0.0\lib\net462\System.Configuration.ConfigurationManager.dll</HintPath>
    </Reference>
    <Reference Include="System.Configuration.Install" />
    <Reference Include="System.Core" />
    <Reference Include="System.Diagnostics.DiagnosticSource, Version=4.0.5.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51, processorArchitecture=MSIL">
      <HintPath>packages\System.Diagnostics.DiagnosticSource.4.7.1\lib\net46\System.Diagnostics.DiagnosticSource.dll</HintPath>
    </Reference>
    <Reference Include="System.IO.Pipelines, Version=5.0.0.2, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51, processorArchitecture=MSIL">
      <HintPath>packages\System.IO.Pipelines.5.0.2\lib\net461\System.IO.Pipelines.dll</HintPath>
    </Reference>
    <Reference Include="System.Management" />
    <Reference Include="System.Memory, Version=4.0.1.2, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51, processorArchitecture=MSIL">
      <HintPath>packages\System.Memory.4.5.5\lib\net461\System.Memory.dll</HintPath>
    </Reference>
    <Reference Include="System.Numerics" />
    <Reference Include="System.Numerics.Vectors, Version=4.1.4.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a, processorArchitecture=MSIL">
      <HintPath>packages\System.Numerics.Vectors.4.5.0\lib\net46\System.Numerics.Vectors.dll</HintPath>
    </Reference>
    <Reference Include="System.Runtime.CompilerServices.Unsafe, Version=4.0.4.1, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a, processorArchitecture=MSIL">
      <HintPath>packages\System.Runtime.CompilerServices.Unsafe.4.5.3\lib\net461\System.Runtime.CompilerServices.Unsafe.dll</HintPath>
    </Reference>
    <Reference Include="System.Security" />
    <Reference Include="System.Threading.Tasks.Extensions, Version=4.2.0.1, Culture=neutral, PublicKeyToken=cc7b13ffcd2ddd51, processorArchitecture=MSIL">
      <HintPath>packages\System.Threading.Tasks.Extensions.4.5.4\lib\net461\System.Threading.Tasks.Extensions.dll</HintPath>
    </Reference>
    <Reference Include="System.Transactions" />
    <Reference Include="System.Xml.Linq" />
    <Reference Include="System.Data.DataSetExtensions" />
    <Reference Include="Microsoft.CSharp" />
    <Reference Include="System.Data" />
    <Reference Include="System.Deployment" />
    <Reference Include="System.Drawing" />
    <Reference Include="System.Net.Http" />
    <Reference Include="System.Windows.Forms" />
    <Reference Include="System.Xml" />
    <Reference Include="Ubiety.Dns.Core, Version=2.2.1.0, Culture=neutral, PublicKeyToken=c5687fc88969c44d, processorArchitecture=MSIL">
      <HintPath>packages\MySql.Data.8.0.26\lib\net48\Ubiety.Dns.Core.dll</HintPath>
    </Reference>
    <Reference Include="Zstandard.Net, Version=1.1.7.0, Culture=neutral, PublicKeyToken=c5687fc88969c44d, processorArchitecture=MSIL">
      <HintPath>packages\MySql.Data.8.0.26\lib\net48\Zstandard.Net.dll</HintPath>
    </Reference>
    <Reference Include="ZstdSharp, Version=0.8.1.0, Culture=neutral, PublicKeyToken=8d151af33a4ad5cf, processorArchitecture=MSIL">
      <HintPath>packages\ZstdSharp.Port.0.8.1\lib\net462\ZstdSharp.dll</HintPath>
    </Reference>
  </ItemGroup>
  <ItemGroup>
    <Compile Include="Data\TiDbEfConfiguration.cs" />
    <Compile Include="Data\HotelDbContext.cs" />
    <Compile Include="Forms\RoomDetailForm.cs">
      <SubType>Form</SubType>
    </Compile>
    <Compile Include="Forms\RoomDetailForm.Designer.cs">
      <DependentUpon>RoomDetailForm.cs</DependentUpon>
    </Compile>
    <Compile Include="Forms\MainForm.cs">
      <SubType>Form</SubType>
    </Compile>
    <Compile Include="Forms\MainForm.Designer.cs">
      <DependentUpon>MainForm.cs</DependentUpon>
    </Compile>
    <Compile Include="Forms\LoginForm.cs">
      <SubType>Form</SubType>
    </Compile>
    <Compile Include="Forms\LoginForm.Designer.cs">
      <DependentUpon>LoginForm.cs</DependentUpon>
    </Compile>
    <Compile Include="Data\DbHelper.cs" />
    <Compile Include="Data\RoomDAL.cs" />
    <Compile Include="Data\BookingDAL.cs" />
    <Compile Include="Data\CustomerDAL.cs" />
    <Compile Include="Data\InvoiceDAL.cs" />
    <Compile Include="Data\UserDAL.cs" />
    <Compile Include="Migrations\202602141602248_init.cs" />
    <Compile Include="Migrations\202602141602248_init.Designer.cs">
      <DependentUpon>202602141602248_init.cs</DependentUpon>
    </Compile>
    <Compile Include="Migrations\Configuration.cs" />
    <Compile Include="Models\ComboBoxItem.cs" />
    <Compile Include="Models\Booking.cs" />
    <Compile Include="Models\Invoice.cs" />
    <Compile Include="Models\User.cs" />
    <Compile Include="Models\Customer.cs" />
    <Compile Include="Models\Room.cs" />
    <Compile Include="Program.cs" />
    <Compile Include="Properties\AssemblyInfo.cs" />
    <EmbeddedResource Include="Migrations\202602141602248_init.resx">
      <DependentUpon>202602141602248_init.cs</DependentUpon>
    </EmbeddedResource>
    <EmbeddedResource Include="Properties\Resources.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>Resources.Designer.cs</LastGenOutput>
      <SubType>Designer</SubType>
    </EmbeddedResource>
    <Compile Include="Properties\Resources.Designer.cs">
      <AutoGen>True</AutoGen>
      <DependentUpon>Resources.resx</DependentUpon>
    </Compile>
    <None Include="packages.config" />
    <None Include="Properties\Settings.settings">
      <Generator>SettingsSingleFileGenerator</Generator>
      <LastGenOutput>Settings.Designer.cs</LastGenOutput>
    </None>
    <Compile Include="Properties\Settings.Designer.cs">
      <AutoGen>True</AutoGen>
      <DependentUpon>Settings.settings</DependentUpon>
      <DesignTimeSharedInput>True</DesignTimeSharedInput>
    </Compile>
  </ItemGroup>
  <ItemGroup>
    <None Include="App.config" />
  </ItemGroup>
  <Import Project="$(MSBuildToolsPath)\Microsoft.CSharp.targets" />
  <Target Name="EnsureNuGetPackageBuildImports" BeforeTargets="PrepareForBuild">
    <PropertyGroup>
      <ErrorText>This project references NuGet package(s) that are missing on this computer. Use NuGet Package Restore to download them.  For more information, see http://go.microsoft.com/fwlink/?LinkID=322105. The missing file is {0}.</ErrorText>
    </PropertyGroup>
    <Error Condition="!Exists('packages\EntityFramework.6.5.1\build\EntityFramework.props')" Text="$([System.String]::Format('$(ErrorText)', 'packages\EntityFramework.6.5.1\build\EntityFramework.props'))" />
    <Error Condition="!Exists('packages\EntityFramework.6.5.1\build\EntityFramework.targets')" Text="$([System.String]::Format('$(ErrorText)', 'packages\EntityFramework.6.5.1\build\EntityFramework.targets'))" />
  </Target>
  <Import Project="packages\EntityFramework.6.5.1\build\EntityFramework.targets" Condition="Exists('packages\EntityFramework.6.5.1\build\EntityFramework.targets')" />
</Project>

================================================================================================
FILE PATH: Hotel Management.sln
================================================================================================

Microsoft Visual Studio Solution File, Format Version 12.00
# Visual Studio Version 17
VisualStudioVersion = 17.14.36511.14 d17.14
MinimumVisualStudioVersion = 10.0.40219.1
Project("{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}") = "Hotel Management", "Hotel Management.csproj", "{D57C892D-E5F8-426C-AB1D-E884C583FFAF}"
EndProject
Global
	GlobalSection(SolutionConfigurationPlatforms) = preSolution
		Debug|Any CPU = Debug|Any CPU
		Release|Any CPU = Release|Any CPU
	EndGlobalSection
	GlobalSection(ProjectConfigurationPlatforms) = postSolution
		{D57C892D-E5F8-426C-AB1D-E884C583FFAF}.Debug|Any CPU.ActiveCfg = Debug|Any CPU
		{D57C892D-E5F8-426C-AB1D-E884C583FFAF}.Debug|Any CPU.Build.0 = Debug|Any CPU
		{D57C892D-E5F8-426C-AB1D-E884C583FFAF}.Release|Any CPU.ActiveCfg = Release|Any CPU
		{D57C892D-E5F8-426C-AB1D-E884C583FFAF}.Release|Any CPU.Build.0 = Release|Any CPU
	EndGlobalSection
	GlobalSection(SolutionProperties) = preSolution
		HideSolutionNode = FALSE
	EndGlobalSection
	GlobalSection(ExtensibilityGlobals) = postSolution
		SolutionGuid = {CEB21CEF-7D0D-4E28-9960-100E0E94307C}
	EndGlobalSection
EndGlobal


================================================================================================
FILE PATH: Migrations\202602141602248_init.cs
================================================================================================
namespace Hotel_Management.Migrations
{
    using System;
    using System.Data.Entity.Migrations;
    
    public partial class init : DbMigration
    {
        public override void Up()
        {
            CreateTable(
                "dbo.DATPHONG",
                c => new
                    {
                        DatPhongID = c.Int(nullable: false, identity: true),
                        KhachHangID = c.Int(nullable: false),
                        PhongID = c.Int(nullable: false),
                        NgayDen = c.DateTime(nullable: false, precision: 0),
                        NgayDiDuKien = c.DateTime(nullable: false, precision: 0),
                        NgayDiThucTe = c.DateTime(precision: 0),
                        TrangThai = c.Int(nullable: false),
                        TienCoc = c.Decimal(nullable: false, precision: 18, scale: 2),
                    })
                .PrimaryKey(t => t.DatPhongID);
            
            CreateTable(
                "dbo.KHACHHANG",
                c => new
                    {
                        KhachHangID = c.Int(nullable: false, identity: true),
                        HoTen = c.String(unicode: false),
                        CCCD = c.String(unicode: false),
                        HinhCCCD = c.Binary(),
                        DienThoai = c.String(unicode: false),
                        DiaChi = c.String(unicode: false),
                    })
                .PrimaryKey(t => t.KhachHangID);
            
            CreateTable(
                "dbo.HOADON",
                c => new
                    {
                        HoaDonID = c.Int(nullable: false, identity: true),
                        DatPhongID = c.Int(nullable: false),
                        NgayLap = c.DateTime(nullable: false, precision: 0),
                        TongTien = c.Decimal(nullable: false, precision: 18, scale: 2),
                        DaThanhToan = c.Boolean(nullable: false),
                    })
                .PrimaryKey(t => t.HoaDonID);
            
            CreateTable(
                "dbo.PHONG",
                c => new
                    {
                        PhongID = c.Int(nullable: false, identity: true),
                        MaPhong = c.String(unicode: false),
                        LoaiPhongID = c.Int(nullable: false),
                        Tang = c.Int(nullable: false),
                        TrangThai = c.Int(nullable: false),
                        GhiChu = c.String(unicode: false),
                        ThoiGianBatDau = c.DateTime(precision: 0),
                        KieuThue = c.Int(),
                        TenKhachHienThi = c.String(unicode: false),
                    })
                .PrimaryKey(t => t.PhongID);
            
            CreateTable(
                "dbo.USERS",
                c => new
                    {
                        UserID = c.Int(nullable: false, identity: true),
                        Username = c.String(unicode: false),
                        Password = c.String(unicode: false),
                        Role = c.String(unicode: false),
                    })
                .PrimaryKey(t => t.UserID);
            
        }
        
        public override void Down()
        {
            DropTable("dbo.USERS");
            DropTable("dbo.PHONG");
            DropTable("dbo.HOADON");
            DropTable("dbo.KHACHHANG");
            DropTable("dbo.DATPHONG");
        }
    }
}


================================================================================================
FILE PATH: Migrations\202602141602248_init.Designer.cs
================================================================================================
// <auto-generated />
namespace Hotel_Management.Migrations
{
    using System.CodeDom.Compiler;
    using System.Data.Entity.Migrations;
    using System.Data.Entity.Migrations.Infrastructure;
    using System.Resources;
    
    [GeneratedCode("EntityFramework.Migrations", "6.5.1")]
    public sealed partial class init : IMigrationMetadata
    {
        private readonly ResourceManager Resources = new ResourceManager(typeof(init));
        
        string IMigrationMetadata.Id
        {
            get { return "202602141602248_init"; }
        }
        
        string IMigrationMetadata.Source
        {
            get { return null; }
        }
        
        string IMigrationMetadata.Target
        {
            get { return Resources.GetString("Target"); }
        }
    }
}


================================================================================================
FILE PATH: Migrations\202602141602248_init.resx
================================================================================================
<?xml version="1.0" encoding="utf-8"?>
<root>
  <!-- 
    Microsoft ResX Schema 
    
    Version 2.0
    
    The primary goals of this format is to allow a simple XML format 
    that is mostly human readable. The generation and parsing of the 
    various data types are done through the TypeConverter classes 
    associated with the data types.
    
    Example:
    
    ... ado.net/XML headers & schema ...
    <resheader name="resmimetype">text/microsoft-resx</resheader>
    <resheader name="version">2.0</resheader>
    <resheader name="reader">System.Resources.ResXResourceReader, System.Windows.Forms, ...</resheader>
    <resheader name="writer">System.Resources.ResXResourceWriter, System.Windows.Forms, ...</resheader>
    <data name="Name1"><value>this is my long string</value><comment>this is a comment</comment></data>
    <data name="Color1" type="System.Drawing.Color, System.Drawing">Blue</data>
    <data name="Bitmap1" mimetype="application/x-microsoft.net.object.binary.base64">
        <value>[base64 mime encoded serialized .NET Framework object]</value>
    </data>
    <data name="Icon1" type="System.Drawing.Icon, System.Drawing" mimetype="application/x-microsoft.net.object.bytearray.base64">
        <value>[base64 mime encoded string representing a byte array form of the .NET Framework object]</value>
        <comment>This is a comment</comment>
    </data>
                
    There are any number of "resheader" rows that contain simple 
    name/value pairs.
    
    Each data row contains a name, and value. The row also contains a 
    type or mimetype. Type corresponds to a .NET class that support 
    text/value conversion through the TypeConverter architecture. 
    Classes that don't support this are serialized and stored with the 
    mimetype set.
    
    The mimetype is used for serialized objects, and tells the 
    ResXResourceReader how to depersist the object. This is currently not 
    extensible. For a given mimetype the value must be set accordingly:
    
    Note - application/x-microsoft.net.object.binary.base64 is the format 
    that the ResXResourceWriter will generate, however the reader can 
    read any of the formats listed below.
    
    mimetype: application/x-microsoft.net.object.binary.base64
    value   : The object must be serialized with 
            : System.Runtime.Serialization.Formatters.Binary.BinaryFormatter
            : and then encoded with base64 encoding.
    
    mimetype: application/x-microsoft.net.object.soap.base64
    value   : The object must be serialized with 
            : System.Runtime.Serialization.Formatters.Soap.SoapFormatter
            : and then encoded with base64 encoding.

    mimetype: application/x-microsoft.net.object.bytearray.base64
    value   : The object must be serialized into a byte array 
            : using a System.ComponentModel.TypeConverter
            : and then encoded with base64 encoding.
    -->
  <xsd:schema id="root" xmlns="" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:msdata="urn:schemas-microsoft-com:xml-msdata">
    <xsd:import namespace="http://www.w3.org/XML/1998/namespace" />
    <xsd:element name="root" msdata:IsDataSet="true">
      <xsd:complexType>
        <xsd:choice maxOccurs="unbounded">
          <xsd:element name="metadata">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="value" type="xsd:string" minOccurs="0" />
              </xsd:sequence>
              <xsd:attribute name="name" use="required" type="xsd:string" />
              <xsd:attribute name="type" type="xsd:string" />
              <xsd:attribute name="mimetype" type="xsd:string" />
              <xsd:attribute ref="xml:space" />
            </xsd:complexType>
          </xsd:element>
          <xsd:element name="assembly">
            <xsd:complexType>
              <xsd:attribute name="alias" type="xsd:string" />
              <xsd:attribute name="name" type="xsd:string" />
            </xsd:complexType>
          </xsd:element>
          <xsd:element name="data">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="value" type="xsd:string" minOccurs="0" msdata:Ordinal="1" />
                <xsd:element name="comment" type="xsd:string" minOccurs="0" msdata:Ordinal="2" />
              </xsd:sequence>
              <xsd:attribute name="name" type="xsd:string" use="required" msdata:Ordinal="1" />
              <xsd:attribute name="type" type="xsd:string" msdata:Ordinal="3" />
              <xsd:attribute name="mimetype" type="xsd:string" msdata:Ordinal="4" />
              <xsd:attribute ref="xml:space" />
            </xsd:complexType>
          </xsd:element>
          <xsd:element name="resheader">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="value" type="xsd:string" minOccurs="0" msdata:Ordinal="1" />
              </xsd:sequence>
              <xsd:attribute name="name" type="xsd:string" use="required" />
            </xsd:complexType>
          </xsd:element>
        </xsd:choice>
      </xsd:complexType>
    </xsd:element>
  </xsd:schema>
  <resheader name="resmimetype">
    <value>text/microsoft-resx</value>
  </resheader>
  <resheader name="version">
    <value>2.0</value>
  </resheader>
  <resheader name="reader">
    <value>System.Resources.ResXResourceReader, System.Windows.Forms, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
  </resheader>
  <resheader name="writer">
    <value>System.Resources.ResXResourceWriter, System.Windows.Forms, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
  </resheader>
  <data name="Target" xml:space="preserve">
    <value>H4sIAAAAAAAEAM1bzXKjOBC+b9W+A8U5E5KZy2zKnikHJ3EqP3YFZu4yyDY1QvKCyMbPNod9pH2FbfEjQGAbMHZSuZhG/anVdOvnU+e/3/8Ovr/5RHvFQegxOtQvzy90DVOHuR5dDvWILz591b9/+/OPwY3rv2k/s3ZfRDvQpOFQX3G+vjKM0FlhH4XnvucELGQLfu4w30AuMz5fXPxlXF4aGCB0wNK0wUtEuefj+AEeTUYdvOYRIk/MxSRM5fDGilG1Z+TjcI0cPNQnjGPyhChaYh9Tfj5GHOnaiHgIbLEwWegaopRxxMHSqx8htnjA6NJagwARe7PG0G6BSIjTEVzlzZsO5uKzGIyRK2ZQThRy5rcEvPySesdQ1Tv5WJfeA//dgJ/5Row69uFQv2bsF3xbXVP7ujJJINpVPZx8k/NU80yL32t5gzMZFxA+4u9MMyPCowAPKY54gMiZNovmxHMe8MZmvzAd0oiQop1gKbwrCUA0C9gaB3zzghep9fCxZyv4mvdjXTPK+oYKINVrdJOB3lP+5bOuPYMxaE6wDIuCUyzOAnyHKQ4Qx+4McY4D+Kr3Lo4dW7FC6fNhhZzVBDXpdDdQQ8t3gzwv0WaMaQYCDsE2ZGE3HG8cPXi9gdmryLFxFWy3rh2Aa+0V8g7ziw3jMJkje8eO5yOia7MAfqUT41ddsxwkIPfhD4w86XamohlnIA465GKm+q7JWAruttnYIjP6S8cJs/OIhXUhngif0Nsjpku+GurwU9duvTfsZpLUhB/UgzURlHgQ7Q0n0zTHR+9k4tFVsaNrj6Jg06yj3chjyAZ7xfKkOtoYxh4yV3130zj97ukr8xzcIftSzXdNvglDY0a7ZF6ueaq0a77y7l8qHtH64CXHBlvs4tp12IRfN2BYlOjKZkj2AbsngsVjP2vHC2N+h8gVau8atp13byffuj2huMujT4KPMNP2kh02yq3tiNDPdupu5Zmr6OiOgzXKu/MQvUZ8jKK2W0fYu0aw6cTKUPd0iWmyb4mXyHdbueBQ22XTKNTeNfmFAV1yP9M7VeqL/ijy8dFDeIbC8B8WuEfv6AUWn5NGq8koRx58ALnpgKgbz4UYv/Ga4AWfp/Ebpr2VB5TAWpiXeYxQ13IzEv7nXFIcxm6I7BBVh5GfzfaApHvBOgy5wdwDIRblOv1kjd+jLGK1TjmZI+o+mPw0OctmJDRbRscZW/i4wRNar4XTc81UolkJOWd+stpzVn6CYThhDXUlrZU9QW7D1KW8ha7B0lsvCLkgBOdIRK/p+pVmSiBucW7WmRJr6hSXez1TEL8LEa/wlDI0FaDckbcwNtE8HiaW9uS8XUUzJkkRQcGOTbfJSOTTfRTaLrTScb0It4ME2IVXa1oHuySlVcSRwpY4ktKqgMk3bREzXquKmL1pjljYnhXhCuIWWBnlVULKhFWcgaEEqJoKRiUXlEVeza1GmZdP0QennpzR2+fedtVTpUtKXBWRUlFzjIQtKkIkkhZWSM6pZIiUNkcqcEyluSkXt8FKWKQyUCL7MIEstwkHx3G2q2gfxls1t0ddxhSVA6+eedr5jXpdjCQPpM6qsbDFJCh5oNIsKKVtxlcgfMoDLLz4MNGY7DgPDsV4g9o+DuvVjr1TkHxOEUcKm+OU+JoiVulFiyBEqlGJ5H32BRl3UwTKZC0sUqiZklnKuxZ7UEnZlFZUKW1hn8rjlAxUX36YtE3OegenbXw0bJ+29WrbXJxxNkXP1vM/+1ASJkbFSaQtDhySainNI1LaHCnhUoooieTEYVI5zqtNZO/yWK8c3wfpUXp/zU3lbJ00ERcm7NVzxbn6aWP9TZL4in+aBNKH5y0gCL0FDnnCIOpfRQFRqWjn4xTQGGHokmZVNB1I0H5LWDzh4710Z0sCv+ZuPu7nsJqVLhBKxYoL4+MxuV+4qbvopX6lV+hyNct+6EbXHerlTBd/KpUu7qkrXTrkS99VJkfJmFJhCYGwT1judl+4WM7RFUMtCxE4c8LmbXEqRSBdDSrXeDRDaV3C0SGs+qufOEpAbZnpDyuY6GmOU8snDpxF6gZfKZ+YM0Z6rZ3oEDJ91S4cJWCUcoWu6VpTjdBpnSnUInTS72OxK9chdPVIfZlBP2u6WoSgjLKRefUlCT1PtNWz3ylv/I+SMOolf9f4UO/wu+IUr+j7+HrqDXz1fnQL56AccXbcryenQEiGOQPLEzPHI3s2mT7fNb5933n5XtfDw2RkTiajBl3IC/jtV/N1HUymo/H0udG1/dZb+zrcZn5JLu633OfXwf6wbl6szlf9VQ5gYBT/O2cwxqG3zCHE/+pQ7IjDdQ6atbmnC5aFNYyoaFHWRF22MEcwl6JRwL0Fcji8dnAYxuH1E5EImtz4c+ze02nE1xEfhSH256RUwjMwdvcf1zOUbR5M1+Ip7GMIYKYnloMpvY484kq7b2u2KFsgRG6mUxtYZXExxS03EumZ0YZAqfvGeI2pmBht7K8JgIVTaqFX3MU2CLxHvETOJmNytoPs/xBltw/gcLAMkB+mGLk+PEIMu/7bt/8BKVkyJ6Q2AAA=</value>
  </data>
  <data name="DefaultSchema" xml:space="preserve">
    <value>dbo</value>
  </data>
</root>

================================================================================================
FILE PATH: Migrations\Configuration.cs
================================================================================================
namespace Hotel_Management.Migrations
{
    using System;
    using System.Data.Entity;
    using System.Data.Entity.Migrations;
    using System.Linq;
    using HotelManagement.Models;
    using System.Collections.Generic;

    internal sealed class Configuration : DbMigrationsConfiguration<HotelManagement.Data.HotelDbContext>
    {
        public Configuration()
        {
            AutomaticMigrationsEnabled = false;
        }

        protected override void Seed(HotelManagement.Data.HotelDbContext context)
        {
            // --- CÁCH KHẮC PHỤC: DÙNG LOGIC INSERT THUẦN TÚY THAY VÌ AddOrUpdate ---
            // TiDB/MySQL đôi khi gặp vấn đề với lệnh MERGE của EF6. 
            // Ta sẽ kiểm tra tồn tại bằng .Any(), nếu chưa có thì .Add() -> SaveChanges()

            // 1. Seed Users
            if (!context.Users.Any(u => u.Username == "admin"))
            {
                context.Users.Add(new User { Username = "admin", Password = "123", Role = "Admin" });
            }

            if (!context.Users.Any(u => u.Username == "letan"))
            {
                context.Users.Add(new User { Username = "letan", Password = "123", Role = "Letan" });
            }

            // Lưu User trước để đảm bảo không lỗi
            context.SaveChanges();

            // 2. Seed Rooms
            // Tạo danh sách phòng cần thêm
            var roomsToAdd = new List<Room>();

            // Tầng 1
            for (int i = 1; i <= 5; i++)
            {
                string ma = "10" + i;
                if (!context.Rooms.Any(r => r.MaPhong == ma))
                {
                    roomsToAdd.Add(new Room { MaPhong = ma, LoaiPhongID = 1, Tang = 1, TrangThai = 0, GhiChu = "" });
                }
            }

            // Tầng 2
            for (int i = 1; i <= 5; i++)
            {
                string ma = "20" + i;
                if (!context.Rooms.Any(r => r.MaPhong == ma))
                {
                    roomsToAdd.Add(new Room { MaPhong = ma, LoaiPhongID = 2, Tang = 2, TrangThai = 0, GhiChu = "" });
                }
            }

            // Tầng 3
            for (int i = 1; i <= 5; i++)
            {
                string ma = "30" + i;
                if (!context.Rooms.Any(r => r.MaPhong == ma))
                {
                    roomsToAdd.Add(new Room { MaPhong = ma, LoaiPhongID = 2, Tang = 3, TrangThai = 0, GhiChu = "" });
                }
            }

            // Thêm tất cả phòng mới vào context
            if (roomsToAdd.Count > 0)
            {
                context.Rooms.AddRange(roomsToAdd);
                context.SaveChanges();
            }
        }
    }
}

================================================================================================
FILE PATH: Models\Booking.cs
================================================================================================
using System;
using System.ComponentModel.DataAnnotations; // Cần thêm dòng này
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace HotelManagement.Models
{
    public class Booking
    {
        [Key] // Đánh dấu thuộc tính này là khóa chính
        public int DatPhongID { get; set; }
        public int KhachHangID { get; set; }
        public int PhongID { get; set; }
        public DateTime NgayDen { get; set; }
        public DateTime NgayDiDuKien { get; set; }
        public DateTime? NgayDiThucTe { get; set; }
        public int TrangThai { get; set; }
        public decimal TienCoc { get; set; }
    }
}

================================================================================================
FILE PATH: Models\ComboBoxItem.cs
================================================================================================
namespace HotelManagement
{
    // Class nhỏ để hiển thị (Text) trong ComboBox nhưng lưu (Value)
    public class ComboBoxItem
    {
        public object Value { get; set; }
        public string Text { get; set; }

        public override string ToString()
        {
            return Text; // ComboBox hiển thị Text
        }
    }
}


================================================================================================
FILE PATH: Models\Customer.cs
================================================================================================
using System;
using System.ComponentModel.DataAnnotations; // Cần thêm dòng này
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace HotelManagement.Models
{
    public class Customer
    {
        [Key] // Đánh dấu thuộc tính này là khóa chính
        public int KhachHangID { get; set; }
        public string HoTen { get; set; }
        public string CCCD { get; set; }
        public byte[] HinhCCCD { get; set; }
        public string DienThoai { get; set; }
        public string DiaChi { get; set; }
    }
}

================================================================================================
FILE PATH: Models\Invoice.cs
================================================================================================
using System;
using System.ComponentModel.DataAnnotations; // Cần thêm dòng này
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace HotelManagement.Models
{
    public class Invoice
    {
        [Key] // Đánh dấu thuộc tính này là khóa chính
        public int HoaDonID { get; set; }
        public int DatPhongID { get; set; }
        public DateTime NgayLap { get; set; }
        public decimal TongTien { get; set; }
        public bool DaThanhToan { get; set; }
    }
}

================================================================================================
FILE PATH: Models\Room.cs
================================================================================================
using System;
using System.ComponentModel.DataAnnotations;

namespace HotelManagement.Models
{
    public class Room
    {
        [Key]
        public int PhongID { get; set; }
        public string MaPhong { get; set; }
        public int LoaiPhongID { get; set; }
        public int Tang { get; set; }
        public int TrangThai { get; set; }
        public string GhiChu { get; set; }
        public DateTime? ThoiGianBatDau { get; set; }
        public int? KieuThue { get; set; }
        public string TenKhachHienThi { get; set; }
    }
}

================================================================================================
FILE PATH: Models\User.cs
================================================================================================
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace HotelManagement.Models
{
    public class User
    {
        public int UserID { get; set; }
        public string Username { get; set; }
        public string Password { get; set; } // demo: lưu plain text
        public string Role { get; set; }     // "Admin" hoặc "Letan"
    }
}



================================================================================================
FILE PATH: packages.config
================================================================================================
<?xml version="1.0" encoding="utf-8"?>
<packages>
  <package id="BouncyCastle" version="1.8.5" targetFramework="net48" />
  <package id="BouncyCastle.Cryptography" version="2.6.2" targetFramework="net48" />
  <package id="EntityFramework" version="6.5.1" targetFramework="net48" />
  <package id="Google.Protobuf" version="3.32.0" targetFramework="net48" />
  <package id="K4os.Compression.LZ4" version="1.2.16" targetFramework="net48" />
  <package id="K4os.Compression.LZ4.Streams" version="1.2.16" targetFramework="net48" />
  <package id="K4os.Hash.xxHash" version="1.0.7" targetFramework="net48" />
  <package id="Microsoft.Bcl.AsyncInterfaces" version="8.0.0" targetFramework="net48" />
  <package id="Microsoft.Extensions.DependencyInjection.Abstractions" version="8.0.2" targetFramework="net48" />
  <package id="Microsoft.Extensions.Logging.Abstractions" version="8.0.3" targetFramework="net48" />
  <package id="MySql.Data" version="8.0.26" targetFramework="net48" />
  <package id="MySql.Data.EntityFramework" version="8.0.26" targetFramework="net48" />
  <package id="MySqlConnector" version="1.3.14" targetFramework="net48" />
  <package id="Portable.BouncyCastle" version="1.9.0" targetFramework="net48" />
  <package id="System.Buffers" version="4.5.1" targetFramework="net48" />
  <package id="System.Configuration.ConfigurationManager" version="8.0.0" targetFramework="net48" />
  <package id="System.Diagnostics.DiagnosticSource" version="4.7.1" targetFramework="net48" />
  <package id="System.IO.Pipelines" version="5.0.2" targetFramework="net48" />
  <package id="System.Memory" version="4.5.5" targetFramework="net48" />
  <package id="System.Numerics.Vectors" version="4.5.0" targetFramework="net48" />
  <package id="System.Runtime.CompilerServices.Unsafe" version="4.5.3" targetFramework="net48" />
  <package id="System.Threading.Tasks.Extensions" version="4.5.4" targetFramework="net48" />
  <package id="ZstdSharp.Port" version="0.8.1" targetFramework="net48" />
</packages>

================================================================================================
FILE PATH: Program.cs
================================================================================================
using System;
using System.Windows.Forms;
using HotelManagement.Forms; // namespace chứa MainForm

namespace HotelManagement
{
    internal static class Program
    {
        [STAThread]
        static void Main()
        {
            Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);

            // KHÔNG chạy LoginForm nữa
            // Application.Run(new LoginForm());

            // Chạy thẳng vào giao diện chính
            Application.Run(new MainForm());
        }
    }
}


================================================================================================
FILE PATH: Properties\AssemblyInfo.cs
================================================================================================
using System.Reflection;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;

// General Information about an assembly is controlled through the following
// set of attributes. Change these attribute values to modify the information
// associated with an assembly.
[assembly: AssemblyTitle("Hotel Management")]
[assembly: AssemblyDescription("")]
[assembly: AssemblyConfiguration("")]
[assembly: AssemblyCompany("MANHPC.COM")]
[assembly: AssemblyProduct("Hotel Management")]
[assembly: AssemblyCopyright("Copyright © MANHPC.COM 2025")]
[assembly: AssemblyTrademark("")]
[assembly: AssemblyCulture("")]

// Setting ComVisible to false makes the types in this assembly not visible
// to COM components.  If you need to access a type in this assembly from
// COM, set the ComVisible attribute to true on that type.
[assembly: ComVisible(false)]

// The following GUID is for the ID of the typelib if this project is exposed to COM
[assembly: Guid("d57c892d-e5f8-426c-ab1d-e884c583ffaf")]

// Version information for an assembly consists of the following four values:
//
//      Major Version
//      Minor Version
//      Build Number
//      Revision
//
[assembly: AssemblyVersion("1.0.0.0")]
[assembly: AssemblyFileVersion("1.0.0.0")]


================================================================================================
FILE PATH: Properties\Resources.Designer.cs
================================================================================================
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

namespace Hotel_Management.Properties
{


    /// <summary>
    ///   A strongly-typed resource class, for looking up localized strings, etc.
    /// </summary>
    // This class was auto-generated by the StronglyTypedResourceBuilder
    // class via a tool like ResGen or Visual Studio.
    // To add or remove a member, edit your .ResX file then rerun ResGen
    // with the /str option, or rebuild your VS project.
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("System.Resources.Tools.StronglyTypedResourceBuilder", "4.0.0.0")]
    [global::System.Diagnostics.DebuggerNonUserCodeAttribute()]
    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    internal class Resources
    {

        private static global::System.Resources.ResourceManager resourceMan;

        private static global::System.Globalization.CultureInfo resourceCulture;

        [global::System.Diagnostics.CodeAnalysis.SuppressMessageAttribute("Microsoft.Performance", "CA1811:AvoidUncalledPrivateCode")]
        internal Resources()
        {
        }

        /// <summary>
        ///   Returns the cached ResourceManager instance used by this class.
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        internal static global::System.Resources.ResourceManager ResourceManager
        {
            get
            {
                if ((resourceMan == null))
                {
                    global::System.Resources.ResourceManager temp = new global::System.Resources.ResourceManager("Hotel_Management.Properties.Resources", typeof(Resources).Assembly);
                    resourceMan = temp;
                }
                return resourceMan;
            }
        }

        /// <summary>
        ///   Overrides the current thread's CurrentUICulture property for all
        ///   resource lookups using this strongly typed resource class.
        /// </summary>
        [global::System.ComponentModel.EditorBrowsableAttribute(global::System.ComponentModel.EditorBrowsableState.Advanced)]
        internal static global::System.Globalization.CultureInfo Culture
        {
            get
            {
                return resourceCulture;
            }
            set
            {
                resourceCulture = value;
            }
        }
    }
}


================================================================================================
FILE PATH: Properties\Resources.resx
================================================================================================
<?xml version="1.0" encoding="utf-8"?>
<root>
  <!-- 
    Microsoft ResX Schema 
    
    Version 2.0
    
    The primary goals of this format is to allow a simple XML format 
    that is mostly human readable. The generation and parsing of the 
    various data types are done through the TypeConverter classes 
    associated with the data types.
    
    Example:
    
    ... ado.net/XML headers & schema ...
    <resheader name="resmimetype">text/microsoft-resx</resheader>
    <resheader name="version">2.0</resheader>
    <resheader name="reader">System.Resources.ResXResourceReader, System.Windows.Forms, ...</resheader>
    <resheader name="writer">System.Resources.ResXResourceWriter, System.Windows.Forms, ...</resheader>
    <data name="Name1"><value>this is my long string</value><comment>this is a comment</comment></data>
    <data name="Color1" type="System.Drawing.Color, System.Drawing">Blue</data>
    <data name="Bitmap1" mimetype="application/x-microsoft.net.object.binary.base64">
        <value>[base64 mime encoded serialized .NET Framework object]</value>
    </data>
    <data name="Icon1" type="System.Drawing.Icon, System.Drawing" mimetype="application/x-microsoft.net.object.bytearray.base64">
        <value>[base64 mime encoded string representing a byte array form of the .NET Framework object]</value>
        <comment>This is a comment</comment>
    </data>
                
    There are any number of "resheader" rows that contain simple 
    name/value pairs.
    
    Each data row contains a name, and value. The row also contains a 
    type or mimetype. Type corresponds to a .NET class that support 
    text/value conversion through the TypeConverter architecture. 
    Classes that don't support this are serialized and stored with the 
    mimetype set.
    
    The mimetype is used for serialized objects, and tells the 
    ResXResourceReader how to depersist the object. This is currently not 
    extensible. For a given mimetype the value must be set accordingly:
    
    Note - application/x-microsoft.net.object.binary.base64 is the format 
    that the ResXResourceWriter will generate, however the reader can 
    read any of the formats listed below.
    
    mimetype: application/x-microsoft.net.object.binary.base64
    value   : The object must be serialized with 
            : System.Serialization.Formatters.Binary.BinaryFormatter
            : and then encoded with base64 encoding.
    
    mimetype: application/x-microsoft.net.object.soap.base64
    value   : The object must be serialized with 
            : System.Runtime.Serialization.Formatters.Soap.SoapFormatter
            : and then encoded with base64 encoding.

    mimetype: application/x-microsoft.net.object.bytearray.base64
    value   : The object must be serialized into a byte array 
            : using a System.ComponentModel.TypeConverter
            : and then encoded with base64 encoding.
    -->
  <xsd:schema id="root" xmlns="" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:msdata="urn:schemas-microsoft-com:xml-msdata">
    <xsd:element name="root" msdata:IsDataSet="true">
      <xsd:complexType>
        <xsd:choice maxOccurs="unbounded">
          <xsd:element name="metadata">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="value" type="xsd:string" minOccurs="0" />
              </xsd:sequence>
              <xsd:attribute name="name" type="xsd:string" />
              <xsd:attribute name="type" type="xsd:string" />
              <xsd:attribute name="mimetype" type="xsd:string" />
            </xsd:complexType>
          </xsd:element>
          <xsd:element name="assembly">
            <xsd:complexType>
              <xsd:attribute name="alias" type="xsd:string" />
              <xsd:attribute name="name" type="xsd:string" />
            </xsd:complexType>
          </xsd:element>
          <xsd:element name="data">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="value" type="xsd:string" minOccurs="0" msdata:Ordinal="1" />
                <xsd:element name="comment" type="xsd:string" minOccurs="0" msdata:Ordinal="2" />
              </xsd:sequence>
              <xsd:attribute name="name" type="xsd:string" msdata:Ordinal="1" />
              <xsd:attribute name="type" type="xsd:string" msdata:Ordinal="3" />
              <xsd:attribute name="mimetype" type="xsd:string" msdata:Ordinal="4" />
            </xsd:complexType>
          </xsd:element>
          <xsd:element name="resheader">
            <xsd:complexType>
              <xsd:sequence>
                <xsd:element name="value" type="xsd:string" minOccurs="0" msdata:Ordinal="1" />
              </xsd:sequence>
              <xsd:attribute name="name" type="xsd:string" use="required" />
            </xsd:complexType>
          </xsd:element>
        </xsd:choice>
      </xsd:complexType>
    </xsd:element>
  </xsd:schema>
  <resheader name="resmimetype">
    <value>text/microsoft-resx</value>
  </resheader>
  <resheader name="version">
    <value>2.0</value>
  </resheader>
  <resheader name="reader">
    <value>System.Resources.ResXResourceReader, System.Windows.Forms, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
  </resheader>
  <resheader name="writer">
    <value>System.Resources.ResXResourceWriter, System.Windows.Forms, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</value>
  </resheader>
</root>

================================================================================================
FILE PATH: Properties\Settings.Designer.cs
================================================================================================
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

namespace Hotel_Management.Properties
{


    [global::System.Runtime.CompilerServices.CompilerGeneratedAttribute()]
    [global::System.CodeDom.Compiler.GeneratedCodeAttribute("Microsoft.VisualStudio.Editors.SettingsDesigner.SettingsSingleFileGenerator", "11.0.0.0")]
    internal sealed partial class Settings : global::System.Configuration.ApplicationSettingsBase
    {

        private static Settings defaultInstance = ((Settings)(global::System.Configuration.ApplicationSettingsBase.Synchronized(new Settings())));

        public static Settings Default
        {
            get
            {
                return defaultInstance;
            }
        }
    }
}


